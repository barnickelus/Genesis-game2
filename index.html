<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Genesis Evolution — Star-Frenzy · 3-D Dragon</title>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
 html,body{margin:0;height:100%;background:#060616;font-family:Inter,Arial,sans-serif;overflow:hidden}
 #game    {position:fixed;inset:0;background:#000;touch-action:none;image-rendering:pixelated}
 #dragonGL{position:fixed;inset:0;pointer-events:none}
 #hud{position:fixed;top:14px;left:18px;color:#fff;font-size:15px;text-shadow:0 0 4px #000b;z-index:2}
 #compass{position:fixed;top:60px;left:18px;color:#aaa;font-size:12px;line-height:12px;letter-spacing:1px;text-shadow:0 0 2px #000;z-index:2}
 #errBox{position:fixed;top:0;left:0;max-width:330px;padding:8px;background:#c00;color:#fff;font:12px/15px monospace;white-space:pre-wrap;z-index:9999;display:none}
</style>
</head>
<body>
<canvas id="game"></canvas>
<canvas id="dragonGL"></canvas>

<div id="hud">Mass <span id="m">0</span></div>
<div id="compass">N<br>E  W<br> S</div>
<div id="errBox"></div>

<!-- ① Preferred CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r156/three.min.js" crossorigin="anonymous"></script>
<!-- ② Fallback CDN (loads only if #1 blocked) -->
<script>
if(!window.THREE){
  var s=document.createElement('script');
  s.src='https://unpkg.com/three@0.156.0/build/three.min.js';
  s.crossOrigin='anonymous';
  document.head.appendChild(s);
}
</script>

<script>
/* Wait until THREE really exists */
(function waitForThree(retry=0){
  if(window.THREE){ startGame(); return; }
  if(retry>40){ showErr('Failed to load Three.js from both CDNs.'); return; }
  setTimeout(()=>waitForThree(retry+1),100);
})();

/* ───────────────────────────────────────── */
/* Show fatal error */
function showErr(msg){ const b=document.getElementById('errBox'); b.textContent=msg; b.style.display='block'; }

/* ───────────────────────────────────────── */
/* Once THREE is present, boot everything   */
function startGame(){

  /* === quick 2-D playground so you can see output === */
  const cvs=document.getElementById('game'), ctx=cvs.getContext('2d',{alpha:false});
  const glc=document.getElementById('dragonGL');
  function fit(){cvs.width=glc.width=innerWidth; cvs.height=glc.height=innerHeight;}
  addEventListener('resize',fit); fit();

  /* ---- mini Three.js head ---- */
  const renderer=new THREE.WebGLRenderer({canvas:glc,alpha:true,antialias:false});
  renderer.setPixelRatio(devicePixelRatio);
  const scene=new THREE.Scene();
  const cam=new THREE.OrthographicCamera(-1,1,1,-1,0.1,10); cam.position.z=4;

  const head=new THREE.Group(); scene.add(head);
  head.add(new THREE.Mesh(new THREE.IcosahedronGeometry(0.55,0),
    new THREE.MeshPhongMaterial({color:0x00dfff,shininess:80})));
  scene.add(new THREE.DirectionalLight(0xffffff,1).position.set(1,1,2));
  scene.add(new THREE.AmbientLight(0x335566,0.5));

  function drawHead(x,y,r,angle){
    head.rotation.z=angle;
    head.scale.setScalar(r*0.018);
    cam.left=-innerWidth/2; cam.right=innerWidth/2;
    cam.top=innerHeight/2; cam.bottom=-innerHeight/2;
    cam.updateProjectionMatrix();
    head.position.set(x-innerWidth/2,-y+innerHeight/2,0);
    renderer.setSize(innerWidth,innerHeight,false);
    renderer.render(scene,cam);
  }

  /* ---- tiny loop ---- */
  let t=0;
  function loop(){
    t+=0.016;
    ctx.fillStyle='#060616'; ctx.fillRect(0,0,innerWidth,innerHeight);
    ctx.fillStyle='#0f0'; ctx.beginPath(); ctx.arc(innerWidth/2,innerHeight/2,40,0,7); ctx.fill();
    drawHead(innerWidth/2,innerHeight/2,40, t);
    requestAnimationFrame(loop);
  }
  loop();
}
</script>
</body>
</html>