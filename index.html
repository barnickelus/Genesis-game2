<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Genesis Evolution — Star-Frenzy · 3-D Dragon</title>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
 html,body{margin:0;height:100%;background:#060616;font-family:Inter,Arial,sans-serif;overflow:hidden}
 #game    {position:fixed;inset:0;background:#000;touch-action:none;image-rendering:pixelated}
 #dragonGL{position:fixed;inset:0;pointer-events:none}
 #hud{position:fixed;top:14px;left:18px;color:#fff;font-size:15px;text-shadow:0 0 4px #000c;z-index:2}
 #compass{position:fixed;top:60px;left:18px;color:#aaa;font-size:12px;line-height:12px;letter-spacing:1px;text-shadow:0 0 2px #000;z-index:2}
 #effBar{position:fixed;bottom:14px;left:18px;width:220px;height:18px;border-radius:9px;background:#ffffff29;z-index:2}
 #effFill{width:100%;height:100%;border-radius:9px;background:#00e4b8}
 #pauseBtn{position:fixed;top:14px;right:18px;font-size:22px;color:#fff;cursor:pointer;user-select:none;z-index:2}
 #radarWrap{position:fixed;top:48px;right:18px;width:70px;height:70px;display:none;z-index:2}
 #radar{width:70px;height:70px;border:1px solid #555;border-radius:4px;background:#0007}
 #zoomSlider{position:fixed;top:130px;right:18px;width:70px;transform:rotate(-90deg);z-index:2}
 #err{position:fixed;top:0;left:0;max-width:340px;padding:6px 8px;background:#c00;color:#fff;font:12px/15px monospace;white-space:pre-wrap;z-index:9;display:none}
</style>
</head>
<body>

<canvas id="game"></canvas>
<canvas id="dragonGL"></canvas>

<div id="hud">Mass <span id="mass">10</span>&nbsp;|&nbsp;Score <span id="score">0</span>&nbsp;|&nbsp;Lvl <span id="level">1</span></div>
<div id="compass">N<br>E  W<br> S</div>
<div id="effBar"><div id="effFill"></div></div>
<div id="pauseBtn">⏸︎</div>
<div id="radarWrap"><canvas id="radar" width="70" height="70"></canvas></div>
<input id="zoomSlider" type="range" min="0.5" max="2" step="0.01" value="1">

<div id="err"></div>

<!-- CDN #1 -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r156/three.min.js" crossorigin="anonymous"></script>
<!-- CDN #2 fallback -->
<script>if(!window.THREE){const s=document.createElement('script');s.src='https://unpkg.com/three@0.156.1/build/three.min.js';s.crossOrigin='anonymous';document.head.appendChild(s);}</script>

<script>
/* simple error overlay */
onerror=(m,src,l)=>{const b=document.getElementById('err');b.textContent=`${m}\n${src}:${l}`;b.style.display='block';};

/* wait until THREE is present */
(function wait(i=0){if(window.THREE){boot();return;}if(i>40){onerror('Three.js failed to load','',0);}else setTimeout(()=>wait(i+1),100);})();

function boot(){
/*════════  A · WebGL dragon head  ════════*/
const glCanvas=document.getElementById('dragonGL'),
      glR=new THREE.WebGLRenderer({canvas:glCanvas,alpha:true,antialias:false});
glR.setPixelRatio(devicePixelRatio);

const glScene=new THREE.Scene(),
      glCam  =new THREE.OrthographicCamera(-1,1,1,-1,0.1,10);glCam.position.z=4;

/* build head */
const head=new THREE.Group();glScene.add(head);
head.add(new THREE.Mesh(new THREE.IcosahedronGeometry(.55,0),
        new THREE.MeshPhongMaterial({color:0x00dfff,shininess:80})));
const jaw=new THREE.Mesh(new THREE.BoxGeometry(.7,.18,.25),
        new THREE.MeshPhongMaterial({color:0x00caff}));
jaw.position.set(.15,-.25,0);jaw.rotation.z=.14;head.add(jaw);
const hornMat=new THREE.MeshPhongMaterial({color:0x00e4b8});
for(let i=0;i<3;i++){const h=new THREE.Mesh(new THREE.ConeGeometry(.06,.45,5),hornMat);
  h.position.set(.12*i,.38+.02*i,-.05*i);h.rotation.z=-Math.PI/7;head.add(h);}
glScene.add(new THREE.DirectionalLight(0xffffff,1).position.set(1,1,2));
glScene.add(new THREE.AmbientLight(0x445566,.55));

function fitGL(){glR.setSize(innerWidth,innerHeight,false);}addEventListener('resize',fitGL);fitGL();

/* FIXED scale line ↓↓↓ */
function drawHead(px,py,radPx,angle){
  head.rotation.z=angle;
  head.scale.setScalar(radPx / 0.55);          // ← correct size

  glCam.left=-innerWidth/2;glCam.right=innerWidth/2;
  glCam.top=innerHeight/2;glCam.bottom=-innerHeight/2;
  glCam.updateProjectionMatrix();

  head.position.set(px-innerWidth/2,-py+innerHeight/2,0);
  glR.render(glScene,glCam);
}

/*════════  B · minimal world so you can test head  ════════*/
const cvs=document.getElementById('game'),ctx=cvs.getContext('2d',{alpha:false});
ctx.imageSmoothingEnabled=false;
let W=0,H=0;function fit2D(){W=cvs.width=innerWidth;H=cvs.height=innerHeight;}fit2D();addEventListener('resize',fit2D);

let p={x:0,y:0,r:18},dir=0,target={x:0,y:0,active:false};
cvs.addEventListener('pointerdown',e=>{target.active=true;setT(e);});
cvs.addEventListener('pointermove',e=>{if(target.active)setT(e);});
cvs.addEventListener('pointerup',()=>target.active=false);
function setT(e){target.x=e.clientX-W/2;target.y=e.clientY-H/2;}

function loop(ts){
  const dx=target.x-p.x,dy=target.y-p.y,len=Math.hypot(dx,dy);
  if(len>1){dir=Math.atan2(dy,dx);p.x+=dx/len*2;p.y+=dy/len*2;}

  ctx.fillStyle='#060616';ctx.fillRect(0,0,W,H);
  ctx.fillStyle='#ff0';ctx.beginPath();ctx.arc(W/2+200*Math.cos(ts*.0007),H/2+200*Math.sin(ts*.0007),5,0,7);ctx.fill();

  /* glow tail */
  const grad=ctx.createLinearGradient(p.x-200,p.y,p.x+200,p.y);
  grad.addColorStop(0,'rgba(0,228,184,.6)');
  grad.addColorStop(1,'rgba(255,57,255,.6)');
  ctx.fillStyle=grad;
  ctx.beginPath();ctx.moveTo(p.x,p.y);ctx.lineTo(p.x-200*Math.cos(dir-.15),p.y-200*Math.sin(dir-.15));ctx.lineTo(p.x-200*Math.cos(dir+.15),p.y-200*Math.sin(dir+.15));ctx.closePath();ctx.fill();

  /* glow body */
  ctx.fillStyle='#00e4b8';ctx.beginPath();ctx.arc(p.x,p.y,18,0,7);ctx.fill();

  drawHead(p.x,p.y,18,dir); // ← renders 3-D head
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);
}
</script>
</body>
</html>