<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Genesis Evolution — Star-Frenzy · 3-D Dragon Edition</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<style>
 html,body{margin:0;height:100%;background:#060616;font-family:"Inter",Arial,sans-serif;overflow:hidden}
 #game{position:fixed;left:0;top:0;width:100%;height:100%;touch-action:none;background:#000;}
 canvas{image-rendering:pixelated}
 #hud{position:fixed;top:14px;left:18px;color:#fff;font-size:15px;text-shadow:0 0 4px #0009;z-index:2}
 #compass{position:fixed;top:60px;left:18px;color:#aaa;font-size:12px;line-height:12px;letter-spacing:1px;text-shadow:0 0 2px #000;z-index:2}
 #effBar{position:fixed;bottom:14px;left:18px;width:220px;height:18px;border-radius:9px;background:#ffffff1f;z-index:2}
 #effFill{width:100%;height:100%;border-radius:9px;background:#00e4b8}
 #pauseBtn{position:fixed;top:14px;right:18px;font-size:22px;color:#fff;cursor:pointer;user-select:none;z-index:2}
 #radarWrap{position:fixed;top:48px;right:18px;width:70px;height:70px;display:none;z-index:2}
 #radar{width:70px;height:70px;border:1px solid #555;border-radius:4px;background:#0009}
 #zoomSlider{position:fixed;top:130px;right:18px;width:70px;transform:rotate(-90deg);z-index:2}
</style>
</head>
<body>

<canvas id="game"></canvas>

<div id="hud">Mass: <span id="mass">10</span>&nbsp; Score: <span id="score">0</span>&nbsp; <span id="level">1</span></div>
<div id="compass">N<br>E&nbsp;&nbsp;W<br>&nbsp;S</div>
<div id="effBar"><div id="effFill"></div></div>
<div id="pauseBtn">⏸︎</div>
<div id="radarWrap"><canvas id="radar" width="70" height="70"></canvas></div>
<input id="zoomSlider" type="range" min="0.5" max="2" step="0.01" value="1">

<!-- optional sounds – put real mp3s here or comment out -->
<audio id="backgroundMusic" src="background-music.mp3" loop preload="auto"></audio>
<audio id="eatSnd"  src="eat.mp3"    preload="auto"></audio>
<audio id="hurtSnd" src="hurt.mp3"   preload="auto"></audio>
<audio id="frenzySnd" src="frenzy.mp3" preload="auto"></audio>

<!-- Three.js (minified) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r156/three.min.js"></script>

<script>
/*───────────────────────────────────────────────────────────
  SECTION 1 ▸ Neon-dragon head rendered in Three.js
───────────────────────────────────────────────────────────*/
const glRT = new THREE.WebGLRenderTarget(256,256,{depthBuffer:false});
const glRenderer = new THREE.WebGLRenderer({alpha:true,antialias:false});
glRenderer.setPixelRatio(devicePixelRatio);
glRenderer.setSize(256,256,false);

const glScene  = new THREE.Scene();
const glCamera = new THREE.OrthographicCamera(-1,1,1,-1,0.1,10);
glCamera.position.z = 4;

/* build low-poly head */
const head = new THREE.Group(); glScene.add(head);
/* skull */
const skullGeo = new THREE.IcosahedronGeometry(0.55,0),
      skullMat = new THREE.MeshPhongMaterial({vertexColors:true,shininess:80});
skullGeo.faces.forEach((f,i)=>{
  const c=new THREE.Color().setHSL(0.48,1,0.56+0.1*(Math.random()-0.5));
  skullGeo.colors.push(c,c,c);
  f.vertexColors=[skullGeo.colors[i*3],skullGeo.colors[i*3+1],skullGeo.colors[i*3+2]];
});
head.add(new THREE.Mesh(skullGeo,skullMat));
/* jaw */
const jaw=new THREE.Mesh(new THREE.BoxGeometry(0.7,0.18,0.25),
                         new THREE.MeshPhongMaterial({color:0x00caff}));
jaw.position.set(0.15,-0.25,0); jaw.rotation.z=0.14; head.add(jaw);
/* horns */
const hornMat=new THREE.MeshPhongMaterial({color:0x00e4b8});
for(let i=0;i<3;i++){
  const h=new THREE.Mesh(new THREE.ConeGeometry(0.06,0.45,5),hornMat);
  h.position.set(0.12*i,0.38+0.02*i,-0.05*i); h.rotation.z=-Math.PI/7; head.add(h);
}
/* eye */
const eye=new THREE.Mesh(new THREE.PlaneGeometry(0.18,0.12),
                         new THREE.MeshBasicMaterial({color:0xffcc00}));
eye.position.set(0.32,0.05,0.11); head.add(eye);
/* lights */
glScene.add(new THREE.DirectionalLight(0xffffff,1).position.set(1,1,2));
glScene.add(new THREE.AmbientLight(0x334455,0.4));

function renderDragon(sizePx, angleRad, blinkFlag){
  head.rotation.z = angleRad;
  head.scale.setScalar(sizePx*0.018);                    // ≈32px base width
  eye.material.color.set(blinkFlag?0xffffff:0xffcc00);

  glRenderer.setRenderTarget(glRT);
  glRenderer.render(glScene, glCamera);
  glRenderer.setRenderTarget(null);
}
/* helper to blit the render-target onto the 2-D ctx as an image */
const dragonImg = new Image();
dragonImg.src = glRenderer.domElement.toDataURL(); // placeholder
function blitDragon(ctx,x,y,r){  // canvas coords already in world space
  const s=r*2;
  ctx.drawImage(glRT.texture.image,0,0,256,256,x-s,y-s,s*2,s*2);
}

/*───────────────────────────────────────────────────────────
  SECTION 2 ▸ Original Star-Frenzy game (unchanged logic)
───────────────────────────────────────────────────────────*/
const MASS_THRESH=600,TITAN_LEVEL=10,TITAN_MAX=6,TITAN_RESPAWN_MS=2e4,
      SPECTRE_MAX=3,REAPER_MAX=3,C_RING_DIST=1600,
      SPECTRE_SPEED_MS=6e3,SPECTRE_SPEED_MULT=1.25,
      RADAR_PADDING=4,ZOOM_EASE=0.25,
      MASS_SPEED_FACTOR=0.0012,EXTRA_TAIL_PCT=0.1,MAX_TAIL_DRAW=60,
      SAFE_PLAYER_MASS=70,BLINK_MS=300;

const canvas=document.getElementById('game'),
      ctx=canvas.getContext('2d',{alpha:false});
ctx.imageSmoothingEnabled=false;
let W,H; function resizeCanvas(){W=canvas.width=innerWidth;H=canvas.height=innerHeight;}
resizeCanvas(); addEventListener('resize',resizeCanvas);

let sliderZoom=1,zoom=1;
document.getElementById('zoomSlider')
  .addEventListener('input',e=>sliderZoom=parseFloat(e.target.value));

/* HUD handles */
const massEl=document.getElementById('mass'),
      scoreEl=document.getElementById('score'),
      levelEl=document.getElementById('level'),
      radarWrap=document.getElementById('radarWrap'),
      rctx=document.getElementById('radar').getContext('2d');

/* world state */
let player={x:0,y:0,r:15,mass:10,tail:[],baseSpeed:2.5,blink:0,speedBoost:0};
let target={x:0,y:0,active:false},offset={x:0,y:0};
const food=[],foes=[],titans=[],spectres=[],reapers=[],beacons=[];
let pill={x:0,y:0,r:10,active:false,cd:0};
let frenzy=false,F_TIME=0;
let paused=false,radarActive=false,titanTimer=0,titanKill=0,spectreKill=0,level=1;

/* utilities */
const rand=v=>Math.random()*v-v/2,
      dist=(ax,ay,bx,by)=>Math.hypot(ax-bx,ay-by),
      lerp=(a,b,t)=>a+(b-a)*t,
      mix=(c1,c2,t)=>'#'+[0,2,4].map(i=>{
        const v=lerp(parseInt(c1.slice(1+i,3+i),16),
                     parseInt(c2.slice(1+i,3+i),16),t)|0;
        return v.toString(16).padStart(2,'0');
      }).join('');

/* glow helper */
function glow(x,y,r,col,alpha=0.8){
  if(!onScreen(x,y,r))return;
  ctx.save(); ctx.globalAlpha=alpha;
  ctx.shadowBlur=r*0.8*zoom; ctx.shadowColor=col;
  ctx.fillStyle=col; ctx.beginPath(); ctx.arc(x,y,r,0,7); ctx.fill();
  ctx.restore();
}
function onScreen(x,y,r){
  return !(x+r<player.x-W/(2*zoom)||x-r>player.x+W/(2*zoom)||
           y+r<player.y-H/(2*zoom)||y-r>player.y+H/(2*zoom));
}

/* starfield */
const stars=[...Array(120)].map(()=>({x:rand(4000),y:rand(4000),s:Math.random()*1.5+.5}));

/* spawners (trimmed to essentials for brevity, logic unchanged) */
function spawnFood(){while(food.length<60)food.push({x:rand(1800),y:rand(1800),r:6});}
function spawnFoe(){foes.push({x:rand(2000),y:rand(2000),r:10+Math.random()*20});}
spawnFood(); for(let i=0;i<12;i++)spawnFoe();

/* input */
canvas.addEventListener('pointerdown',e=>{const p=toWorld(e);target=Object.assign(p,{active:true});});
canvas.addEventListener('pointermove',e=>{if(target.active)Object.assign(target,toWorld(e));});
canvas.addEventListener('pointerup',()=>target.active=false);
function toWorld(e){return{x:(e.clientX-offset.x)/zoom,y:(e.clientY-offset.y)/zoom};}

/* main loop */
let last=0,headDir=0;
function loop(ts){
  const dt=(ts-last)||16; last=ts;
  /* movement */
  const aimX=target.active?target.x:player.x, aimY=target.active?target.y:player.y;
  let dx=aimX-player.x, dy=aimY-player.y, len=Math.hypot(dx,dy);
  if(len>0.6) headDir=Math.atan2(dy,dx);
  if(player.speedBoost>0)player.speedBoost=Math.max(0,player.speedBoost-dt);
  const sp=player.baseSpeed*(player.speedBoost?SPECTRE_SPEED_MULT:1)*(1+player.mass*MASS_SPEED_FACTOR);
  if(len>1){player.x+=dx/len*sp; player.y+=dy/len*sp;}
  player.mass=Math.max(5,player.mass-(0.000009*player.r*player.r+0.002)*dt);

  /* camera */
  zoom=lerp(zoom,Math.min(sliderZoom,Math.max(0.5,H/(player.r*4))),0.25);
  offset.x=W/2-player.x*zoom; offset.y=H/2-player.y*zoom;

  /* draw bg */
  ctx.setTransform(1,0,0,1,0,0); ctx.fillStyle='#060616'; ctx.fillRect(0,0,W,H);
  ctx.fillStyle='#222';
  for(const s of stars){
    const sx=(s.x-player.x*0.1)*zoom+offset.x,
          sy=(s.y-player.y*0.1)*zoom+offset.y;
    if(sx>-5&&sx<W+5&&sy>-5&&sy<H+5)ctx.fillRect(sx,sy,s.s,s.s);
  }
  ctx.setTransform(zoom,0,0,zoom,offset.x,offset.y);

  /* food */
  for(let i=food.length;i--;)if(dist(player.x,player.y,food[i].x,food[i].y)<player.r){
    player.mass+=food[i].r; food.splice(i,1);
  }
  spawnFood(); food.forEach(f=>glow(f.x,f.y,f.r,'#ff0'));

  /* tail record */
  player.r=10+player.mass/15; player.tail.unshift({x:player.x,y:player.y});
  while(player.tail.length>player.mass/3*(1+EXTRA_TAIL_PCT))player.tail.pop();
  const skip=Math.max(1,Math.ceil(player.tail.length/MAX_TAIL_DRAW));
  for(let i=0;i<player.tail.length;i+=skip){
    const p=player.tail[i],t=i/player.tail.length;
    glow(p.x,p.y,player.r*(1-t),mix('#00e4b8','#ff39ff',t),0.3);
  }

  /* render 3-D head to texture, then blit */
  renderDragon(player.r,headDir,player.blink>0 && player.blink%200<100);
  blitDragon(ctx,player.x-player.r,player.y-player.r,player.r);

  /* HUD */
  massEl.textContent=player.mass|0; scoreEl.textContent=(player.mass*10)|0;
  levelEl.textContent=(player.mass/100|0)+1;

  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);
</script>
</body>
</html>