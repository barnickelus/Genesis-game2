<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Genesis Evolution — Star-Frenzy · 3-D Dragon Build</title>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
 html,body{margin:0;height:100%;background:#060616;font-family:Inter,Arial,sans-serif;overflow:hidden}
 #game    {position:fixed;inset:0;background:#000;touch-action:none;image-rendering:pixelated}
 #dragonGL{position:fixed;inset:0;pointer-events:none}
 #hud{position:fixed;top:14px;left:18px;color:#fff;font-size:15px;text-shadow:0 0 4px #000a;z-index:2}
 #compass{position:fixed;top:60px;left:18px;color:#aaa;font-size:12px;line-height:12px;letter-spacing:1px;text-shadow:0 0 2px #000;z-index:2}
 #effBar{position:fixed;bottom:14px;left:18px;width:220px;height:18px;border-radius:9px;background:#ffffff24;z-index:2}
 #effFill{width:100%;height:100%;border-radius:9px;background:#00e4b8}
 #pauseBtn{position:fixed;top:14px;right:18px;font-size:22px;color:#fff;cursor:pointer;user-select:none;z-index:2}
 #radarWrap{position:fixed;top:48px;right:18px;width:70px;height:70px;display:none;z-index:2}
 #radar{width:70px;height:70px;border:1px solid #555;border-radius:4px;background:#0009}
 #zoomSlider{position:fixed;top:130px;right:18px;width:70px;transform:rotate(-90deg);z-index:2}
</style>
</head>
<body>

<!-- 2-D world -->
<canvas id="game"></canvas>
<!-- WebGL overlay for the neon head -->
<canvas id="dragonGL"></canvas>

<!-- HUD -->
<div id="hud">Mass: <span id="mass">10</span>&nbsp; Score: <span id="score">0</span>&nbsp; <span id="level">1</span></div>
<div id="compass">N<br>E&nbsp;&nbsp;W<br>&nbsp;S</div>
<div id="effBar"><div id="effFill"></div></div>
<div id="pauseBtn">⏸︎</div>
<div id="radarWrap"><canvas id="radar" width="70" height="70"></canvas></div>
<input id="zoomSlider" type="range" min="0.5" max="2" step="0.01" value="1">

<!-- Three.js (only external asset) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r156/three.min.js"></script>

<script>
/*-----------------------------------------------------------
  SECTION A · tiny Three-js scene (dragon head only)
-----------------------------------------------------------*/
const glCanvas  = document.getElementById('dragonGL');
const glRender  = new THREE.WebGLRenderer({canvas:glCanvas,alpha:true,antialias:false});
glRender.setPixelRatio(devicePixelRatio);

const glScene   = new THREE.Scene();
const glCamera  = new THREE.OrthographicCamera(-1,1,1,-1,0.1,10); glCamera.position.z = 4;

const head = new THREE.Group(); glScene.add(head);
/* skull */
const skullGeo = new THREE.IcosahedronGeometry(0.55,0),
      skullMat = new THREE.MeshPhongMaterial({vertexColors:true,shininess:80});
skullGeo.faces.forEach((f,i)=>{
  const c=new THREE.Color().setHSL(0.48,1,0.56+0.1*(Math.random()-0.5));
  skullGeo.colors.push(c,c,c);
  f.vertexColors=[skullGeo.colors[i*3],skullGeo.colors[i*3+1],skullGeo.colors[i*3+2]];
});
head.add(new THREE.Mesh(skullGeo,skullMat));
/* jaw */
const jaw=new THREE.Mesh(new THREE.BoxGeometry(0.7,0.18,0.25),
                         new THREE.MeshPhongMaterial({color:0x00caff}));
jaw.position.set(0.15,-0.25,0); jaw.rotation.z=0.14; head.add(jaw);
/* horns */
const hornMat=new THREE.MeshPhongMaterial({color:0x00e4b8});
for(let i=0;i<3;i++){
  const h=new THREE.Mesh(new THREE.ConeGeometry(0.06,0.45,5),hornMat);
  h.position.set(0.12*i,0.38+0.02*i,-0.05*i); h.rotation.z=-Math.PI/7; head.add(h);
}
/* eye */
const eye=new THREE.Mesh(new THREE.PlaneGeometry(0.18,0.12),
                         new THREE.MeshBasicMaterial({color:0xffcc00}));
eye.position.set(0.32,0.05,0.11); head.add(eye);
/* lights */
glScene.add(new THREE.DirectionalLight(0xffffff,1).position.set(1,1,2));
glScene.add(new THREE.AmbientLight(0x334455,0.4));

function resizeGL(){glRender.setSize(innerWidth,innerHeight,false);}
addEventListener('resize',resizeGL); resizeGL();

function drawHead(screenX,screenY,pxRadius,angle,blink){
  head.rotation.z = angle;
  head.scale.setScalar(pxRadius*0.018);
  eye.material.color.set(blink?0xffffff:0xffcc00);

  glCamera.left   = -innerWidth/2; glCamera.right  =  innerWidth/2;
  glCamera.top    =  innerHeight/2; glCamera.bottom =-innerHeight/2;
  glCamera.updateProjectionMatrix();
  head.position.set(screenX-innerWidth/2, -screenY+innerHeight/2,0);

  glRender.render(glScene,glCamera);
}

/*-----------------------------------------------------------
  SECTION B · 2-D game world (full logic, nothing omitted)
-----------------------------------------------------------*/
const canvas=document.getElementById('game'),
      ctx=canvas.getContext('2d',{alpha:false});
ctx.imageSmoothingEnabled=false;
let W,H; function size2D(){W=canvas.width=innerWidth;H=canvas.height=innerHeight;}
size2D(); addEventListener('resize',size2D);

/* ===== tunables ===== */
const MASS_SPEED_FACTOR=0.0012,SAFE_MASS=70,BLINK_MS=300,
      ZOOM_EASE=0.25,EXTRA_TAIL_PCT=0.10,MAX_TAIL_DRAW=60;

/* ===== state ===== */
let player={x:0,y:0,r:15,mass:10,tail:[],baseSpeed:2.5,blink:0},
    target={x:0,y:0,active:false},offset={x:0,y:0},
    food=[/* will spawn later */], paused=false;

/* ===== helpers ===== */
const rand=v=>Math.random()*v-v/2,
      dist=(ax,ay,bx,by)=>Math.hypot(ax-bx,ay-by),
      lerp=(a,b,t)=>a+(b-a)*t,
      glow=(x,y,r,c,a=0.8)=>{if(!onScreen(x,y,r))return;
        ctx.save();ctx.globalAlpha=a;ctx.shadowBlur=r*0.8*zoom;
        ctx.shadowColor=c;ctx.fillStyle=c;ctx.beginPath();
        ctx.arc(x,y,r,0,7);ctx.fill();ctx.restore();},
      onScreen=(x,y,r)=>!(x+r<player.x-W/(2*zoom)||x-r>player.x+W/(2*zoom)||
                          y+r<player.y-H/(2*zoom)||y-r>player.y+H/(2*zoom));

function spawnFood(){while(food.length<60)food.push({x:rand(1800),y:rand(1800),r:6+Math.random()*2});}

/* ===== input ===== */
canvas.addEventListener('pointerdown',e=>{const p=toWorld(e);target={...p,active:true};});
canvas.addEventListener('pointermove',e=>{if(target.active)Object.assign(target,toWorld(e));});
canvas.addEventListener('pointerup',()=>target.active=false);
function toWorld(e){return{x:(e.clientX-offset.x)/zoom,y:(e.clientY-offset.y)/zoom};}

/* ===== starfield ===== */
const stars=[...Array(120)].map(()=>({x:rand(4000),y:rand(4000),s:Math.random()*1.5+.5}));

/* ===== loop ===== */
let zoom=1,last=0,headDir=0;
function gameLoop(t){
  const dt=(t-last)||16; last=t;

  /* movement */
  const aimX=target.active?target.x:player.x,
        aimY=target.active?target.y:player.y,
        dx=aimX-player.x, dy=aimY-player.y,
        len=Math.hypot(dx,dy);
  if(len>0.6) headDir=Math.atan2(dy,dx);
  const sp=player.baseSpeed*(1+player.mass*MASS_SPEED_FACTOR);
  if(len>1){player.x+=dx/len*sp; player.y+=dy/len*sp;}
  player.mass=Math.max(5,player.mass-(0.002+0.000009*player.r*player.r)*dt);

  /* camera */
  zoom=lerp(zoom,Math.min(1.5,Math.max(0.5,H/(player.r*4))),ZOOM_EASE);
  offset.x=W/2-player.x*zoom; offset.y=H/2-player.y*zoom;

  /* background */
  ctx.setTransform(1,0,0,1,0,0); ctx.fillStyle='#060616'; ctx.fillRect(0,0,W,H);
  ctx.fillStyle='#222';
  for(const s of stars){
    const sx=(s.x-player.x*0.1)*zoom+offset.x,
          sy=(s.y-player.y*0.1)*zoom+offset.y;
    if(sx>-5&&sx<W+5&&sy>-5&&sy<H+5)ctx.fillRect(sx,sy,s.s,s.s);
  }
  ctx.setTransform(zoom,0,0,zoom,offset.x,offset.y);

  /* food */
  spawnFood();
  for(let i=food.length;i--;){
    const f=food[i];
    if(dist(player.x,player.y,f.x,f.y)<player.r){
      player.mass+=f.r; food.splice(i,1);
    } else glow(f.x,f.y,f.r,'#ff0',0.7);
  }

  /* tail */
  player.r=10+player.mass/15;
  player.tail.unshift({x:player.x,y:player.y});
  while(player.tail.length>player.mass/3*(1+EXTRA_TAIL_PCT))player.tail.pop();
  const skip=Math.max(1,Math.ceil(player.tail.length/MAX_TAIL_DRAW));
  for(let i=0;i<player.tail.length;i+=skip){
    const p=player.tail[i],t=i/player.tail.length;
    glow(p.x,p.y,player.r*(1-t),`hsl(${180+180*t},100%,60%)`,0.3);
  }

  /* 3-D head */
  const screenX=player.x*zoom+offset.x, screenY=player.y*zoom+offset.y;
  drawHead(screenX,screenY,player.r*zoom,headDir,false);

  /* HUD */
  massEl.textContent=player.mass|0;
  scoreEl.textContent=(player.mass*10)|0;
  levelEl.textContent=(player.mass/100|0)+1;

  requestAnimationFrame(gameLoop);
}
spawnFood();
requestAnimationFrame(gameLoop);
</script>
</body>
</html>