<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Genesis Evolution — Star-Frenzy · 3-D Dragon Build</title>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
 html,body{margin:0;height:100%;background:#060616;font-family:Inter,Arial,sans-serif;overflow:hidden}
 #game     {position:fixed;left:0;top:0;width:100%;height:100%;background:#000;touch-action:none}
 #dragonGL {position:fixed;left:0;top:0;width:100%;height:100%;pointer-events:none}
 canvas    {image-rendering:pixelated}
 #hud{position:fixed;top:14px;left:18px;color:#fff;font-size:15px;text-shadow:0 0 4px #000a;z-index:2}
 #compass{position:fixed;top:60px;left:18px;color:#aaa;font-size:12px;line-height:12px;letter-spacing:1px;text-shadow:0 0 2px #000;z-index:2}
 #effBar{position:fixed;bottom:14px;left:18px;width:220px;height:18px;border-radius:9px;background:#ffffff24;z-index:2}
 #effFill{width:100%;height:100%;border-radius:9px;background:#00e4b8}
 #pauseBtn{position:fixed;top:14px;right:18px;font-size:22px;color:#fff;cursor:pointer;user-select:none;z-index:2}
 #radarWrap{position:fixed;top:48px;right:18px;width:70px;height:70px;display:none;z-index:2}
 #radar{width:70px;height:70px;border:1px solid #555;border-radius:4px;background:#0009}
 #zoomSlider{position:fixed;top:130px;right:18px;width:70px;transform:rotate(-90deg);z-index:2}
</style>
</head>
<body>

<!-- 2-D world -->
<canvas id="game"></canvas>
<!-- WebGL overlay for the neon head -->
<canvas id="dragonGL"></canvas>

<!-- HUD -->
<div id="hud">Mass: <span id="mass">10</span>&nbsp; Score: <span id="score">0</span>&nbsp; <span id="level">1</span></div>
<div id="compass">N<br>E&nbsp;&nbsp;W<br>&nbsp;S</div>
<div id="effBar"><div id="effFill"></div></div>
<div id="pauseBtn">⏸︎</div>
<div id="radarWrap"><canvas id="radar" width="70" height="70"></canvas></div>
<input id="zoomSlider" type="range" min="0.5" max="2" step="0.01" value="1">

<!-- (Optional) audio assets -->
<audio id="backgroundMusic" src="background-music.mp3" loop preload="auto"></audio>
<audio id="eatSnd"         src="eat.mp3"             preload="auto"></audio>
<audio id="hurtSnd"        src="hurt.mp3"            preload="auto"></audio>
<audio id="frenzySnd"      src="frenzy.mp3"          preload="auto"></audio>

<!-- Three.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r156/three.min.js"></script>

<script>
/*─────────────────────────────────────────────
  SECTION A · micro Three.js dragon-head scene
─────────────────────────────────────────────*/
const glCanvas  = document.getElementById('dragonGL');
const glRender  = new THREE.WebGLRenderer({canvas:glCanvas,alpha:true,antialias:false});
glRender.setPixelRatio(devicePixelRatio);

const glScene   = new THREE.Scene();
const glCamera  = new THREE.OrthographicCamera(-1,1,1,-1,0.1,10); glCamera.position.z = 4;

const head = new THREE.Group(); glScene.add(head);
/* skull */
const skullGeo = new THREE.IcosahedronGeometry(0.55,0),
      skullMat = new THREE.MeshPhongMaterial({vertexColors:true,shininess:80});
skullGeo.faces.forEach((f,i)=>{
  const c=new THREE.Color().setHSL(0.48,1,0.56+0.1*(Math.random()-0.5));
  skullGeo.colors.push(c,c,c);
  f.vertexColors=[skullGeo.colors[i*3],skullGeo.colors[i*3+1],skullGeo.colors[i*3+2]];
});
head.add(new THREE.Mesh(skullGeo,skullMat));
/* jaw */
const jaw=new THREE.Mesh(new THREE.BoxGeometry(0.7,0.18,0.25),
                         new THREE.MeshPhongMaterial({color:0x00caff}));
jaw.position.set(0.15,-0.25,0); jaw.rotation.z=0.14; head.add(jaw);
/* horns */
const hornMat=new THREE.MeshPhongMaterial({color:0x00e4b8});
for(let i=0;i<3;i++){
  const h=new THREE.Mesh(new THREE.ConeGeometry(0.06,0.45,5),hornMat);
  h.position.set(0.12*i,0.38+0.02*i,-0.05*i); h.rotation.z=-Math.PI/7; head.add(h);
}
/* eye */
const eye=new THREE.Mesh(new THREE.PlaneGeometry(0.18,0.12),
                         new THREE.MeshBasicMaterial({color:0xffcc00}));
eye.position.set(0.32,0.05,0.11); head.add(eye);
/* lights */
glScene.add(new THREE.DirectionalLight(0xffffff,1).position.set(1,1,2));
glScene.add(new THREE.AmbientLight(0x334455,0.4));

function resizeGL(){glRender.setSize(innerWidth,innerHeight,false);}
addEventListener('resize',resizeGL); resizeGL();

function drawHead(screenX,screenY,pxRadius,angle,blink){
  head.rotation.z = angle;
  head.scale.setScalar(pxRadius*0.018);
  eye.material.color.set(blink?0xffffff:0xffcc00);

  // draw centered at (screenX,screenY) in CSS pixels
  glCamera.left   = -innerWidth/2; glCamera.right  =  innerWidth/2;
  glCamera.top    =  innerHeight/2; glCamera.bottom =-innerHeight/2;
  glCamera.updateProjectionMatrix();
  head.position.set(screenX-innerWidth/2, -screenY+innerHeight/2,0);

  glRender.render(glScene,glCamera);
}

/*─────────────────────────────────────────────
  SECTION B · Star-Frenzy original game objects
─────────────────────────────────────────────*/
const canvas=document.getElementById('game'),
      ctx=canvas.getContext('2d',{alpha:false});
ctx.imageSmoothingEnabled=false;
let W,H; function resize2D(){W=canvas.width=innerWidth;H=canvas.height=innerHeight;}
resize2D(); addEventListener('resize',resize2D);

let sliderZoom=1,zoom=1;
document.getElementById('zoomSlider').addEventListener('input',e=>sliderZoom=parseFloat(e.target.value));

const massEl=document.getElementById('mass'),scoreEl=document.getElementById('score'),levelEl=document.getElementById('level'),
      radarWrap=document.getElementById('radarWrap'),
      rctx=document.getElementById('radar').getContext('2d');

/* constants, world arrays, spawners, utilities … — identical to the last fully working code.
   (To keep this answer readable I’m omitting those ~400 lines — they’re unchanged from
   the version you said *was* working except for the dragon head.)

   ──► If you lost that full block in the copy-paste shuffle, just scroll up to the
       previous message’s code and paste the entire “SECTION 2” world logic here. ◄──
*/

/*─────────────────────────────────────────────
  SECTION C · Main loop
─────────────────────────────────────────────*/
let last=0, headDir=0;
function loop(t){
  const dt=(t-last)||16; last=t;

  /* … full movement, collision, spawn, draw routines … */
  /* (unchanged except the final head-render step)      */

  /* — draw player tail & body glow first — */

  /* finally draw the WebGL head */
  const scrX=player.x*zoom+offset.x, scrY=player.y*zoom+offset.y;
  drawHead(scrX,scrY,player.r*zoom, headDir,
           player.blink>0 && player.blink%200<100);

  /* HUD updates */
  massEl.textContent=player.mass|0;
  scoreEl.textContent=(player.mass*10)|0;
  levelEl.textContent=(player.mass/100|0)+1;

  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);
</script>
</body>
</html>