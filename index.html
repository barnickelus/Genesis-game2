<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Genesis Evolution — Star-Frenzy (SVG-Dragon build)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<style>
 html,body{margin:0;height:100%;background:#060616;overflow:hidden;font-family:"Inter",Arial,sans-serif;}
 canvas{width:100%;height:100%;display:block;touch-action:none;background:#000;}
 #hud{position:fixed;top:14px;left:18px;color:#fff;font-size:15px;text-shadow:0 0 4px rgba(255,255,255,.3);z-index:2;}
 #compass{position:fixed;top:60px;left:18px;color:#aaa;font-size:12px;line-height:12px;letter-spacing:1px;text-shadow:0 0 2px #000;z-index:2;}
 #effBar{position:fixed;bottom:14px;left:18px;width:220px;height:18px;border-radius:9px;background:rgba(255,255,255,.12);z-index:2;}
 #effFill{width:100%;height:100%;border-radius:9px;background:#00e4b8;}
 #pauseBtn{position:fixed;top:14px;right:18px;font-size:22px;color:#fff;cursor:pointer;user-select:none;z-index:2;}
 #radarWrap{position:fixed;top:48px;right:18px;width:70px;height:70px;display:none;z-index:2;}
 #radar{width:70px;height:70px;border:1px solid #555;border-radius:4px;background:rgba(0,0,0,.4);}
 #zoomSlider{position:fixed;top:130px;right:18px;width:70px;transform:rotate(-90deg);z-index:2;}
</style>
</head>
<body>
<canvas id="game"></canvas>

<!-- HUD -->
<div id="hud">Mass: <span id="mass">10</span>&nbsp; Score: <span id="score">0</span>&nbsp; <span id="level">1</span></div>
<div id="compass">N<br>E&nbsp;&nbsp;W<br>&nbsp;S</div>
<div id="effBar"><div id="effFill"></div></div>
<div id="pauseBtn">⏸︎</div>
<div id="radarWrap"><canvas id="radar" width="70" height="70"></canvas></div>
<input id="zoomSlider" type="range" min="0.5" max="2" step="0.01" value="1">

<!-- Audio -->
<audio id="backgroundMusic" src="background-music.mp3" loop preload="auto"></audio>
<audio id="eatSnd"        src="eat.mp3"       preload="auto"></audio>
<audio id="hurtSnd"       src="hurt.mp3"      preload="auto"></audio>
<audio id="frenzySnd"     src="frenzy.mp3"    preload="auto"></audio>

<!-- Sprite-sheet (5×256) -->
<img id="dragonSheet" src="dragon_sprite_v4.svg" alt="" style="display:none">

<script>
/* ==========================================================
   DragonHead — 5-frame sprite sheet, rotation + scale
   ========================================================== */
const SHEET   = document.getElementById('dragonSheet');
const FW      = 256;          // frame width  in sheet
const SCALE   = 1.55;         // head visual size
let   READY   = false;        SHEET.onload = () => READY = true;
const oct = a => (Math.round((((a % (2*Math.PI)) + 2*Math.PI) / (Math.PI/4))) & 7);
const frameFor = a => {
  const o = oct(a), R = Math.cos(a) >= 0;
  if (o === 2 || o === 6) return 2;      // top
  if (o & 1)              return R ? 1 : 3;
  return                               R ? 0 : 4;
};
const DragonHead = {
  draw(ctx,x,y,r,a,blink=0){
    if(!READY) return;
    const f  = frameFor(a), size = r*2*SCALE;
    ctx.save();
    ctx.translate(x,y);
    ctx.rotate(a);
    ctx.drawImage(SHEET, f*FW, 0, FW, 256, -size/2, -size/2, size, size);
    if(blink){
      ctx.globalAlpha = .25;
      ctx.fillStyle   = '#fff';
      ctx.beginPath(); ctx.arc(0,0,r*SCALE,0,Math.PI*2); ctx.fill();
    }
    ctx.restore();
  }
};

/* ==========================================================
   CONSTANTS
   ========================================================== */
const MASS_THRESH=600,TITAN_LEVEL=10,TITAN_MAX=6,TITAN_RESPAWN_MS=20000,
      SPECTRE_MAX=3,REAPER_MAX=3,C_RING_DIST=1600,
      SPECTRE_SPEED_MS=6000,SPECTRE_SPEED_MULT=1.25,
      RADAR_PADDING=4,ZOOM_EASE=0.25,
      MASS_SPEED_FACTOR=0.0012,EXTRA_TAIL_PCT=0.10,MAX_TAIL_DRAW=60,
      SAFE_PLAYER_MASS=70,BLINK_MS=300;

/* ==========================================================
   CANVAS & VIEWPORT
   ========================================================== */
const canvas=document.getElementById('game'),
      ctx    =canvas.getContext('2d',{alpha:false});
ctx.imageSmoothingEnabled=false;
let W,H; const resize=()=>{W=canvas.width=innerWidth;H=canvas.height=innerHeight;};
resize(); addEventListener('resize',resize);

let sliderZoom=1,zoom=1;
document.getElementById('zoomSlider').oninput=e=>sliderZoom=parseFloat(e.target.value);

/* ==========================================================
   WORLD DATA
   ========================================================== */
const rand=v=>Math.random()*v-v/2,
      dist=(a,b,c,d)=>Math.hypot(a-c,b-d),
      lerp=(a,b,t)=>a+(b-a)*t,
      rgb=h=>({r:parseInt(h.slice(1,3),16),g:parseInt(h.slice(3,5),16),b:parseInt(h.slice(5,7),16)}),
      mix=(a,b,t)=>{const A=rgb(a),B=rgb(b);return`rgb(${Math.round(lerp(A.r,B.r,t))},${Math.round(lerp(A.g,B.g,t))},${Math.round(lerp(A.b,B.b,t))})`;};

const food=[],foes=[],titans=[],spectres=[],reapers=[],beacons=[],particles=[];
let player={x:0,y:0,r:15,mass:10,tail:[],baseSpeed:2.5,blink:0,speedBoost:0,heading:0},
    target={x:0,y:0,active:false}, offset={x:0,y:0},
    pill={x:0,y:0,r:10,active:false,cd:0},
    frenzy=false,F_TIME=0,paused=false,radarActive=false,
    titanTimer=0,titanKill=0,spectreKill=0,level=1;

/* STARFIELD */
const STARS=120,stars=[...Array(STARS)].map(()=>({x:rand(4000),y:rand(4000),s:Math.random()*1.5+0.5}));

/* SPAWNERS */
const spawnFood=()=>{while(food.length<60)food.push({x:rand(1800),y:rand(1800),r:6});};
const spawnFoe =()=>{foes.push({x:rand(2000),y:rand(2000),r:(player.mass>=MASS_THRESH?14:10)+Math.random()*20});};
const spawnTitan=()=>{const a=Math.random()*Math.PI*2,d=700+Math.random()*500;titans.push({x:player.x+Math.cos(a)*d,y:player.y+Math.sin(a)*d,r:25+Math.random()*35,hop:0});};
const spawnSpectre=()=>{const a=Math.random()*Math.PI*2,d=600+Math.random()*400;spectres.push({x:player.x+Math.cos(a)*d,y:player.y+Math.sin(a)*d,r:22+Math.random()*25,dash:0});};
const spawnReaper =()=>{const a=Math.random()*Math.PI*2,d=800+Math.random()*600;reapers.push({x:player.x+Math.cos(a)*d,y:player.y+Math.sin(a)*d,r:38+Math.random()*28,charge:0});};
const spawnPill   =()=>{pill={x:rand(1800),y:rand(1800),r:10,active:true,cd:0};};

/* INITIAL CONTENT */
spawnFood(); for(let i=0;i<12;i++)spawnFoe();
['N','S','E','W'].forEach(d=>{const p={N:[0,-C_RING_DIST],S:[0,C_RING_DIST],E:[C_RING_DIST,0],W:[-C_RING_DIST,0]}[d];beacons.push({x:p[0],y:p[1],r:18});});

/* INPUT */
const toWorld=e=>({x:(e.clientX-offset.x)/zoom,y:(e.clientY-offset.y)/zoom});
canvas.onpointerdown=e=>{if(paused)return;const p=toWorld(e);target={x:p.x,y:p.y,active:true};};
canvas.onpointermove=e=>{if(target.active&&!paused){const p=toWorld(e);target.x=p.x;target.y=p.y;}};
canvas.onpointerup   =()=>target.active=false;

/* PAUSE */
document.getElementById('pauseBtn').onclick=()=>{
  paused=!paused; pauseBtn.textContent=paused?'▶︎':'⏸︎';
  const bg=document.getElementById('backgroundMusic'); if(bg)paused?bg.pause():bg.play().catch(()=>{});
};

/* DRAW HELPERS */
const onScr=(x,y,r)=>!(x+r<player.x-W/(2*zoom)||x-r>player.x+W/(2*zoom)||y+r<player.y-H/(2*zoom)||y-r>player.y+H/(2*zoom));
const glow=(x,y,r,c,a)=>{if(r*zoom<0.8||!onScr(x,y,r))return;ctx.globalAlpha=a;ctx.shadowBlur=12*zoom;ctx.shadowColor=c;ctx.fillStyle=c;ctx.beginPath();ctx.arc(x,y,r,0,Math.PI*2);ctx.fill();ctx.shadowBlur=0;ctx.globalAlpha=1;};
const grid=()=>{const step=zoom<=.8?60:120;ctx.lineWidth=1.2;for(let z=0;z<6;z++){const s=1+z*.15,opa=.8-.12*z;ctx.strokeStyle=`rgba(34,34,34,${opa})`;for(let i=-4;i<=4;i++)for(let j=-4;j<=4;j++){const x=i*step*s,y=j*step*s;if(!onScr(x,y,step*s*1.4))continue;ctx.beginPath();ctx.rect(x,y,step*s,step*s);ctx.stroke();}}};
const burst=(x,y,c)=>{for(let i=0;i<12;i++)particles.push({x,y,dx:rand(2),dy:rand(2),r:3,ttl:600,col:c});};

/* ==========================================================
   GAME LOOP
   ========================================================== */
let last=0;
const loop=ts=>{
  if(paused){last=ts;return requestAnimationFrame(loop);}
  const dt=(ts-last)||16; last=ts;

  /* camera zoom */
  zoom=lerp(zoom,Math.min(sliderZoom,Math.max(.5,H/(player.r*4))),ZOOM_EASE);

  /* player movement */
  const dx=(target.active?target.x:player.x)-player.x,
        dy=(target.active?target.y:player.y)-player.y,
        dLen=Math.hypot(dx,dy);
  if(dLen>0.5) player.heading=Math.atan2(dy,dx);
  if(player.speedBoost>0) player.speedBoost=Math.max(0,player.speedBoost-dt);
  const sp=player.baseSpeed*(player.speedBoost>0?SPECTRE_SPEED_MULT:1)*(frenzy?1.3:1)*(1+player.mass*MASS_SPEED_FACTOR);
  if(dLen>1){player.x+=dx/dLen*sp;player.y+=dy/dLen*sp;}

  /* mass decay */
  player.mass=Math.max(5,player.mass-(0.000009*player.r*player.r+(player.mass<150?.002:.003))*dt);

  /* viewport */
  offset.x=W/2-player.x*zoom; offset.y=H/2-player.y*zoom;

  /* ---------- BACKDROP ---------- */
  ctx.setTransform(1,0,0,1,0,0); ctx.clearRect(0,0,W,H);
  ctx.fillStyle='#060616'; ctx.fillRect(0,0,W,H); ctx.fillStyle='#222';
  for(const s of stars){const sx=(s.x-player.x*.1)*zoom+offset.x,sy=(s.y-player.y*.1)*zoom+offset.y;if(sx<0||sx>W||sy<0||sy>H)continue;ctx.fillRect(sx,sy,s.s,s.s);}
  ctx.setTransform(zoom,0,0,zoom,offset.x,offset.y); grid();

  /* ---------- FOOD ---------- */
  for(let i=food.length-1;i>=0;i--){const f=food[i];
    if(dist(player.x,player.y,f.x,f.y)<player.r+f.r){
      player.mass+=f.r; food.splice(i,1); burst(f.x,f.y,'#ff0'); document.getElementById('eatSnd').play().catch(()=>{});}
  } spawnFood();

  /* ---------- FOES ---------- */
  while(foes.length<(player.mass>=MASS_THRESH?18:12))spawnFoe();
  foes.forEach((o,i)=>{
    const d=dist(player.x,player.y,o.x,o.y);
    if(player.r>o.r&&d<player.r){player.mass+=o.r*2.5;foes.splice(i,1);burst(o.x,o.y,'#f00');document.getElementById('eatSnd').play().catch(()=>{});return;}
    if(o.r>player.r&&d<o.r){if(player.blink<50)player.blink=BLINK_MS;player.mass=Math.max(5,player.mass-.04*dt);document.getElementById('hurtSnd').play().catch(()=>{});}
    const c=1;
    if(o.r<player.r&&d<250){o.x-=(player.x-o.x)/d*c; o.y-=(player.y-o.y)/d*c;}
    else if(o.r>player.r&&d<250){o.x+=(player.x-o.x)/d*c; o.y+=(player.y-o.y)/d*c;}
  });

  /* ---------- TITANS ---------- */
  if(level>=TITAN_LEVEL){
    while(titans.length<TITAN_MAX)spawnTitan();
    titanTimer+=dt; if(titanTimer>TITAN_RESPAWN_MS){titanTimer=0; titans.length=0;}
  }
  titans.forEach((o,i)=>{
    const d=dist(player.x,player.y,o.x,o.y);
    if(d>2000){titans.splice(i,1); spawnTitan(); return;}
    if(player.r>o.r&&d<player.r){player.mass+=o.r*5; titans.splice(i,1); titanKill++; burst(o.x,o.y,'#cc00ff'); return;}
    if(o.r>player.r&&d<o.r){if(player.blink<50)player.blink=BLINK_MS;player.mass=Math.max(5,player.mass-.1*dt);document.getElementById('hurtSnd').play().catch(()=>{});}
    o.hop-=dt; if(o.hop<=0){o.hop=700; const hop=o.r>player.r?120:-80; o.x+=(player.x-o.x)/d*hop; o.y+=(player.y-o.y)/d*hop;}
  });

  /* ---------- SPECTRES ---------- */
  if(titanKill>=10) while(spectres.length<SPECTRE_MAX)spawnSpectre();
  spectres.forEach((s,i)=>{
    s.dash-=dt;
    const d=dist(player.x,player.y,s.x,s.y), ignore=player.mass<SAFE_PLAYER_MASS;
    if(d>2200){spectres.splice(i,1); spawnSpectre(); return;}
    if(!ignore&&d<player.r){
      player.mass+=s.r*7; player.speedBoost=SPECTRE_SPEED_MS; spectres.splice(i,1);
      document.getElementById('eatSnd').play().catch(()=>{}); spectreKill++;
      if(spectreKill%6===0&&reapers.length<REAPER_MAX)spawnReaper(); return;
    }
    if(!ignore&&d<s.r&&s.r>player.r){
      if(player.blink<50)player.blink=BLINK_MS; player.mass=Math.max(5,player.mass-.2*dt);
      document.getElementById('hurtSnd').play().catch(()=>{});
    }
    const jump=ignore?-100:(s.r>player.r?160:-100);
    if(s.dash<=0){
      s.dash=400;
      s.x+=(player.x-s.x)/d*jump;
      s.y+=(player.y-s.y)/d*jump;
    }
  });

  /* ---------- REAPERS ---------- */
  reapers.forEach((r,i)=>{
    r.charge-=dt;
    const d=dist(player.x,player.y,r.x,r.y), ignore=player.mass<SAFE_PLAYER_MASS;
    if(d>2400){reapers.splice(i,1); return;}
    if(!ignore&&d<player.r){player.mass+=r.r*10; reapers.splice(i,1); burst(r.x,r.y,'#ff8800'); return;}
    if(!ignore&&d<r.r&&r.r>player.r){
      if(player.blink<50)player.blink=BLINK_MS; player.mass=Math.max(5,player.mass-.25*dt);
      document.getElementById('hurtSnd').play().catch(()=>{});
    }
    const step=ignore?-100:(r.r>player.r?130:-100);
    if(r.charge<=0){
      r.charge=300;
      r.x+=(player.x-r.x)/d*step;
      r.y+=(player.y-r.y)/d*step;
    }
  });

  /* ---------- PILL / FRENZY ---------- */
  if(pill.active&&dist(player.x,player.y,pill.x,pill.y)<player.r+pill.r){
    frenzy=true; F_TIME=10000; pill.active=false;
    document.getElementById('frenzySnd').play().catch(()=>{});
    for(let i=0;i<40;i++){
      const a=Math.random()*Math.PI*2, R=120+Math.random()*120;
      food.push({cx:player.x,cy:player.y,ang:a,baseR:R,angV:.004+Math.random()*.003,x:player.x+Math.cos(a)*R,y:player.y+Math.sin(a)*R,r:5,frenzy:true,col:'#ff39ff'});
    }
  }
  if(frenzy){F_TIME-=dt; if(F_TIME<=0){frenzy=false; food.forEach(f=>f.frenzy=false);}}
  food.forEach(f=>{if(f.frenzy){f.ang+=f.angV*dt; f.x=f.cx+Math.cos(f.ang)*f.baseR; f.y=f.cy+Math.sin(f.ang)*f.baseR;}});
  if(!pill.active&&!frenzy){pill.cd+=dt; if(pill.cd>25000+Math.random()*10000)spawnPill();}

  /* ---------- BEACONS ---------- */
  beacons.forEach(b=>{
    if(dist(player.x,player.y,b.x,b.y)<player.r+b.r){
      beacons.length=0; radarActive=true; document.getElementById('radarWrap').style.display='block';
    }
  });

  /* ---------- SIZE / TAIL ---------- */
  player.r=10+player.mass/15;
  level=Math.floor(player.mass/100)+1;
  player.tail.unshift({x:player.x,y:player.y});
  while(player.tail.length>Math.ceil(player.mass/3*(1+EXTRA_TAIL_PCT)))player.tail.pop();
  if(player.blink>0)player.blink-=dt;

  /* ---------- DRAW GLOWS ---------- */
  food.forEach(f=>glow(f.x,f.y,f.r,f.frenzy?f.col:'#ff0',f.frenzy?.8:.65));
  foes.forEach(o=>glow(o.x,o.y,o.r,'#f00',.8));
  titans.forEach(o=>glow(o.x,o.y,o.r,'#cc00ff',.9));
  spectres.forEach(s=>glow(s.x,s.y,s.r,mix('#ffde59','#ff39ff',(Math.sin((ts+s.x)*.006)+1)/2),.9));
  reapers.forEach(r=>glow(r.x,r.y,r.r,mix('#ff8800','#ff39ff',(Math.sin((ts+r.y)*.004)+1)/2),.9));
  if(pill.active){const pH=(Math.sin(ts*.005)+1)/2;glow(pill.x,pill.y,pill.r,mix('#00aaff','#ff39ff',pH),.95);}

  const skip=Math.max(1,Math.ceil(player.tail.length/MAX_TAIL_DRAW));
  for(let i=0;i<player.tail.length;i+=skip){
    const p=player.tail[i];
    glow(p.x,p.y,player.r*(1-i/player.tail.length),mix('#00e4b8','#ff39ff',i/player.tail.length),.3);
  }
  if(frenzy){
    ctx.globalAlpha=.15;
    const g=ctx.createRadialGradient(player.x,player.y,player.r*.8,player.x,player.y,player.r*8);
    g.addColorStop(0,'#ff39ff'); g.addColorStop(1,'transparent');
    ctx.fillStyle=g; ctx.beginPath(); ctx.arc(player.x,player.y,player.r*8,0,Math.PI*2); ctx.fill();
    ctx.globalAlpha=1;
  }

  /* player glow + head */
  glow(player.x,player.y,player.r,player.blink>0?(player.blink%200<100?'#fff':'#ff44ff'):'#00e4b8',1);
  DragonHead.draw(ctx,player.x,player.y,player.r*.75,player.heading,player.blink>0);

  /* PARTICLES */
  particles.forEach((p,i)=>{
    p.x+=p.dx; p.y+=p.dy; p.ttl-=dt;
    glow(p.x,p.y,p.r,p.col,.6);
    if(p.ttl<=0)particles.splice(i,1);
  });

  /* RADAR */
  if(radarActive){
    const rctx=document.getElementById('radar').getContext('2d');
    rctx.clearRect(0,0,70,70);
    rctx.strokeStyle='#666'; rctx.lineWidth=1;
    rctx.beginPath(); rctx.moveTo(35,0); rctx.lineTo(35,70);
    rctx.moveTo(0,35); rctx.lineTo(70,35); rctx.stroke();
    const mc=Math.max(C_RING_DIST,Math.abs(player.x),Math.abs(player.y))||1, scale=(30-RADAR_PADDING)/mc;
    const pip=(arr,col,s)=>{
      rctx.fillStyle=col;
      arr.forEach(o=>{
        const x=35+o.x*scale, y=35+o.y*scale;
        if(x<0||x>70||y<0||y>70) return;
        if(s==='d'){rctx.beginPath(); rctx.moveTo(x,y-2); rctx.lineTo(x+2,y); rctx.lineTo(x,y+2); rctx.lineTo(x-2,y); rctx.fill();}
        else if(s==='t'){rctx.beginPath(); rctx.moveTo(x,y-2); rctx.lineTo(x+2,y+2); rctx.lineTo(x-2,y+2); rctx.fill();}
        else rctx.fillRect(x-2,y-2,4,4);
      });
    };
    pip([player],'#00e4b8');
    pip(titans,'#cc00ff','d');
    pip(spectres,'#ff39ff','t');
    pip(reapers,'#ff8800');
  }

  /* HUD */
  document.getElementById('mass').textContent = player.mass.toFixed(0);
  document.getElementById('score').textContent = Math.floor(player.mass*10);
  document.getElementById('level').textContent = level;

  requestAnimationFrame(loop);
};
requestAnimationFrame(loop);

/* mobile autoplay */
addEventListener('pointerdown',()=>{
  const bg=document.getElementById('backgroundMusic');
  if(bg && bg.paused) bg.play().catch(()=>{});
},{once:true});
</script>
</body>
</html>