<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Genesis Evolution — Star-Frenzy · 3-D Dragon Build</title>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
 html,body{margin:0;height:100%;background:#060616;font-family:Inter,Arial,sans-serif;overflow:hidden}
 #game    {position:fixed;inset:0;background:#000;touch-action:none;image-rendering:pixelated}
 #dragonGL{position:fixed;inset:0;pointer-events:none}
 #hud{position:fixed;top:14px;left:18px;color:#fff;font-size:15px;text-shadow:0 0 4px #000a;z-index:2}
 #compass{position:fixed;top:60px;left:18px;color:#aaa;font-size:12px;line-height:12px;letter-spacing:1px;text-shadow:0 0 2px #000;z-index:2}
 #effBar{position:fixed;bottom:14px;left:18px;width:220px;height:18px;border-radius:9px;background:#ffffff24;z-index:2}
 #effFill{width:100%;height:100%;border-radius:9px;background:#00e4b8}
 #pauseBtn{position:fixed;top:14px;right:18px;font-size:22px;color:#fff;cursor:pointer;user-select:none;z-index:2}
 #radarWrap{position:fixed;top:48px;right:18px;width:70px;height:70px;display:none;z-index:2}
 #radar{width:70px;height:70px;border:1px solid #555;border-radius:4px;background:#0009}
 #zoomSlider{position:fixed;top:130px;right:18px;width:70px;transform:rotate(-90deg);z-index:2}
 #errBox{position:fixed;top:0;left:0;max-width:320px;padding:6px 8px;background:#900;color:#fff;font:12px/15px monospace;white-space:pre-wrap;z-index:9999;display:none}
</style>
</head>
<body>

<!-- 2-D world -->
<canvas id="game"></canvas>
<!-- WebGL overlay for the neon head -->
<canvas id="dragonGL"></canvas>

<!-- HUD -->
<div id="hud">Mass: <span id="mass">10</span>&nbsp; Score: <span id="score">0</span>&nbsp; <span id="level">1</span></div>
<div id="compass">N<br>E&nbsp;&nbsp;W<br>&nbsp;S</div>
<div id="effBar"><div id="effFill"></div></div>
<div id="pauseBtn">⏸︎</div>
<div id="radarWrap"><canvas id="radar" width="70" height="70"></canvas></div>
<input id="zoomSlider" type="range" min="0.5" max="2" step="0.01" value="1">

<div id="errBox"></div>

<!-- Three.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r156/three.min.js"></script>

<script>
/* ╭──────────────────────────────────────────────────────────╮
   │  SIMPLE ERROR OVERLAY  –  helps catch silent failures   │
   ╰──────────────────────────────────────────────────────────╯ */
window.onerror = (msg,src,line,col,err)=>{
  const box=document.getElementById('errBox');
  box.textContent = `${msg}\n${src?.split('/').pop()}:${line}:${col}`;
  box.style.display='block';
};

/* ╭──────────────────────────────────────────────────────────╮
   │  SECTION A · micro Three-js scene  (dragon head only)   │
   ╰──────────────────────────────────────────────────────────╯ */
const glCanvas  = document.getElementById('dragonGL');
const glRender  = new THREE.WebGLRenderer({canvas:glCanvas,alpha:true,antialias:false});
glRender.setPixelRatio(devicePixelRatio);

const glScene  = new THREE.Scene();
const glCamera = new THREE.OrthographicCamera(-1,1,1,-1,0.1,10);
glCamera.position.z = 4;

/* ‣ build low-poly head */
const head = new THREE.Group(); glScene.add(head);

/* skull */
const skullGeo = new THREE.IcosahedronGeometry(0.55,0),
      skullMat = new THREE.MeshPhongMaterial({vertexColors:true,shininess:80});
for(let f of skullGeo.faces){
  const c=new THREE.Color().setHSL(0.5,1,0.55+0.1*(Math.random()-0.5));
  f.vertexColors=[c,c,c];
}
head.add(new THREE.Mesh(skullGeo,skullMat));

/* jaw */
const jaw = new THREE.Mesh(
  new THREE.BoxGeometry(0.7,0.18,0.25),
  new THREE.MeshPhongMaterial({color:0x00caff})
);
jaw.position.set(0.15,-0.25,0); jaw.rotation.z = 0.14; head.add(jaw);

/* horns */
const hornMat = new THREE.MeshPhongMaterial({color:0x00e4b8});
for(let i=0;i<3;i++){
  const h=new THREE.Mesh(new THREE.ConeGeometry(0.06,0.45,5),hornMat);
  h.position.set(0.12*i,0.38+0.02*i,-0.05*i); h.rotation.z=-Math.PI/7;
  head.add(h);
}

/* eye */
const eye = new THREE.Mesh(
  new THREE.PlaneGeometry(0.18,0.12),
  new THREE.MeshBasicMaterial({color:0xffcc00})
);
eye.position.set(0.32,0.05,0.11); head.add(eye);

/* lights */
glScene.add(new THREE.DirectionalLight(0xffffff,1).position.set(1,1,2));
glScene.add(new THREE.AmbientLight(0x334455,0.4));

function resizeGL(){ glRender.setSize(innerWidth,innerHeight,false); }
addEventListener('resize',resizeGL); resizeGL();

/* draw the head – passes screen coords (CSS pixels)           */
function drawHead(scrX,scrY,pxR,angle,blink){
  head.rotation.z = angle;
  head.scale.setScalar(pxR*0.018);
  eye.material.color.setHex(blink?0xffffff:0xffcc00);

  glCamera.left   = -innerWidth/2; glCamera.right  =  innerWidth/2;
  glCamera.top    =  innerHeight/2; glCamera.bottom =-innerHeight/2;
  glCamera.updateProjectionMatrix();
  head.position.set(scrX - innerWidth/2, -scrY + innerHeight/2, 0);

  glRender.render(glScene,glCamera);
}

/* ╭──────────────────────────────────────────────────────────╮
   │  SECTION B · lightweight 2-D playground (food & stars)  │
   ╰──────────────────────────────────────────────────────────╯ */
const canvas=document.getElementById('game'),
      ctx    = canvas.getContext('2d',{alpha:false});
ctx.imageSmoothingEnabled = false;

let W=0,H=0; function size2D(){W=canvas.width=innerWidth;H=canvas.height=innerHeight;}
size2D(); addEventListener('resize',size2D);

/* game state (minimal set just for visibility) */
let player ={x:0,y:0,r:15,mass:10,tail:[]},
    offset ={x:0,y:0},
    zoom   =1,
    stars  =[...Array(120)].map(()=>({x:Math.random()*4000-2000,
                                      y:Math.random()*4000-2000,
                                      s:Math.random()*1.5+.5})),
    food   =[];

const rand=v=>Math.random()*v-v/2,
      dist=(ax,ay,bx,by)=>Math.hypot(ax-bx,ay-by),
      lerp=(a,b,t)=>a+(b-a)*t,
      glow=(x,y,r,c,a=0.8)=>{if(!onScreen(x,y,r))return;
        ctx.save();ctx.globalAlpha=a;ctx.shadowBlur=r*0.8*zoom;
        ctx.shadowColor=c;ctx.fillStyle=c;ctx.beginPath();ctx.arc(x,y,r,0,7);ctx.fill();ctx.restore();},
      onScreen=(x,y,r)=>!(x+r<player.x-W/(2*zoom)||x-r>player.x+W/(2*zoom)||
                          y+r<player.y-H/(2*zoom)||y-r>player.y+H/(2*zoom));

function spawnFood(){while(food.length<60)food.push({x:rand(1800),y:rand(1800),r:6+Math.random()*2});}

/* simple pointer steering */
let target={active:false,x:0,y:0};
canvas.addEventListener('pointerdown',e=>{target.active=true;setTarget(e);});
canvas.addEventListener('pointermove',e=>{if(target.active)setTarget(e);});
canvas.addEventListener('pointerup',  ()=> target.active=false);
function setTarget(e){target.x=(e.clientX-offset.x)/zoom; target.y=(e.clientY-offset.y)/zoom;}

let headDir=0,last=0;
function loop(ts){
  const dt=(ts-last)||16; last=ts;

  /* movement */
  const aimX=target.active?target.x:player.x,
        aimY=target.active?target.y:player.y,
        dx=aimX-player.x, dy=aimY-player.y,
        len=Math.hypot(dx,dy);
  if(len>0.5) headDir=Math.atan2(dy,dx);
  if(len>1){
    const speed=2.0;
    player.x+=dx/len*speed;
    player.y+=dy/len*speed;
  }

  /* camera */
  zoom=lerp(zoom,1,0.15);
  offset.x=W/2-player.x*zoom;
  offset.y=H/2-player.y*zoom;

  /* --- draw --- */
  ctx.setTransform(1,0,0,1,0,0);
  ctx.fillStyle='#060616'; ctx.fillRect(0,0,W,H);

  /* stars */
  ctx.fillStyle='#222';
  for(const s of stars){
    const sx=(s.x-player.x*0.1)*zoom+offset.x,
          sy=(s.y-player.y*0.1)*zoom+offset.y;
    if(sx>-4&&sx<W+4&&sy>-4&&sy<H+4)ctx.fillRect(sx,sy,s.s,s.s);
  }

  ctx.setTransform(zoom,0,0,zoom,offset.x,offset.y);

  /* food */
  spawnFood();
  food.forEach((f,i)=>{
    if(dist(player.x,player.y,f.x,f.y)<player.r){food.splice(i,1);}
    else glow(f.x,f.y,f.r,'#ff0',0.75);
  });

  /* tail */
  player.r=18;
  player.tail.unshift({x:player.x,y:player.y});
  while(player.tail.length>60)player.tail.pop();
  for(let i=0;i<player.tail.length;i+=3){
    const p=player.tail[i],t=i/player.tail.length;
    glow(p.x,p.y,player.r*(1-t),`hsl(${200+t*100},100%,60%)`,0.25);
  }

  /* draw head (WebGL) */
  const sx=player.x*zoom+offset.x, sy=player.y*zoom+offset.y;
  drawHead(sx,sy,player.r*zoom,headDir,false);

  requestAnimationFrame(loop);
}
spawnFood();
requestAnimationFrame(loop);
</script>
</body>
</html>