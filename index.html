<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Genesis Evolution — Star-Frenzy + Floor-Glow</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<style>
 html,body{margin:0;height:100%;background:#060616;overflow:hidden;font-family:"Inter",Arial,sans-serif;overscroll-behavior:contain;}
 canvas{width:100%;height:100%;display:block;touch-action:none;-webkit-touch-callout:none;user-select:none;background:#000;}
 /* HUD / UI */
 #hud{position:fixed;top:14px;left:18px;color:#fff;font-size:15px;text-shadow:0 0 4px rgba(255,255,255,.3);z-index:2;}
 #compass{position:fixed;top:60px;left:18px;color:#aaa;font-size:12px;line-height:12px;letter-spacing:1px;text-shadow:0 0 2px #000;z-index:2;}
 #effBar{position:fixed;bottom:14px;left:18px;width:220px;height:18px;border-radius:9px;background:rgba(255,255,255,.12);z-index:2;}
 #effFill{width:100%;height:100%;border-radius:9px;background:#00e4b8;}
 #pauseBtn{position:fixed;top:14px;right:18px;font-size:22px;color:#fff;cursor:pointer;user-select:none;z-index:2;}
 #radarWrap{position:fixed;top:48px;right:18px;width:70px;height:70px;display:none;z-index:2;}
 #radar{width:70px;height:70px;border:1px solid #555;border-radius:4px;background:rgba(0,0,0,.4);}
 #zoomSlider{position:fixed;top:130px;right:18px;width:70px;transform:rotate(-90deg);z-index:2;}
 #comboMsg{position:fixed;top:14px;right:110px;color:#ffde59;font-size:18px;font-weight:600;text-shadow:0 0 8px #ffde59;opacity:0;transition:opacity .2s;z-index:2;}
</style>
</head>
<body>
<canvas id="game"></canvas>

<!-- HUD -->
<div id="hud">Mass: <span id="mass">10</span>&nbsp; Score: <span id="score">0</span>&nbsp; <span id="level">1</span></div>
<div id="compass">N<br>E&nbsp;&nbsp;W<br>&nbsp;S</div>
<div id="effBar"><div id="effFill"></div></div>
<span id="comboMsg"></span>
<div id="pauseBtn">⏸︎</div>
<div id="radarWrap"><canvas id="radar" width="70" height="70"></canvas></div>
<input id="zoomSlider" type="range" min="0.5" max="2" step="0.01" value="1">

<!-- optional SFX -->
<audio id="eatSnd"    src="eat.mp3"    preload="auto"></audio>
<audio id="hurtSnd"   src="hurt.mp3"   preload="auto"></audio>
<audio id="frenzySnd" src="frenzy.mp3" preload="auto"></audio>
<audio id="backgroundMusic" src="background-music.mp3" loop preload="auto"></audio>

<script>
/* ═════════════ CONSTANTS ═════════════ */
const MASS_THRESH=600,TITAN_LEVEL=10,TITAN_MAX=6,TITAN_RESPAWN_MS=20000,
      SPECTRE_MAX=3,REAPER_MAX=3,C_RING_DIST=1600;
const SPECTRE_SPEED_MS=6000,SPECTRE_SPEED_MULT=1.25,
      MASS_SPEED_FACTOR=0.0012,EXTRA_TAIL_PCT=0.10,MAX_TAIL_DRAW=60,
      SAFE_MASS=70,SAFE_DIST=350,BLINK_MS=300;
const NOVA_SPAWN_MS=45000,NOVA_R=14,NOVA_BLAST_MS=2000,NOVA_BLAST_DIST=320;
const COMBO_WINDOW=3000,COMBO_BONUS=0.05,ZOOM_EASE=0.25,RADAR_PADDING=4;

/* ═════════════ CANVAS ═════════════ */
const canvas=document.getElementById("game"),ctx=canvas.getContext("2d",{alpha:false});
ctx.imageSmoothingEnabled=false;
let W,H;function resize(){W=canvas.width=innerWidth;H=canvas.height=innerHeight;}resize();addEventListener("resize",resize);
let zoom=1,sliderZoom=1;document.getElementById("zoomSlider").addEventListener("input",e=>sliderZoom=parseFloat(e.target.value));

/* ═════════════ HUD refs ═════════════ */
const massEl=document.getElementById("mass"),scoreEl=document.getElementById("score"),levelEl=document.getElementById("level"),
      comboEl=document.getElementById("comboMsg"),rWrap=document.getElementById("radarWrap"),
      rctx=document.getElementById("radar").getContext("2d");

/* ═════════════ WORLD ARRAYS ─ player & mobs ═════════════ */
let player={x:0,y:0,r:15,mass:10,tail:[],baseSpeed:2.5,blink:0,speedBoost:0};
let target={x:0,y:0,active:false},offset={x:0,y:0};
const food=[],foes=[],titans=[],spectres=[],reapers=[],beacons=[];
let nova={x:0,y:0,r:NOVA_R,active:false,cd:0},novaBlast=0,shake=0;
let combo=0,comboTimer=0,score=0,frenzy=false,F_TIME=0;
let paused=false,radarActive=false,titanKill=0,spectreKill=0,level=1;

/* ═════════════ STARFIELD BACKDROP ═════════════ */
const STARS=120,stars=[...Array(STARS)].map(()=>({x:Math.random()*4000-2000,y:Math.random()*4000-2000,s:Math.random()*1.5+0.5}));

/* ═════════════ UTILITIES ═════════════ */
const rand=v=>Math.random()*v-v/2,
      dist=(a,b,c,d)=>Math.hypot(a-c,b-d),
      lerp=(a,b,t)=>a+(b-a)*t,
      onScr=(x,y,r)=>!(x+r<player.x-W/(2*zoom)||x-r>player.x+W/(2*zoom)||y+r<player.y-H/(2*zoom)||y-r>player.y+H/(2*zoom));

function glow(x,y,r,c,a){if(r*zoom<0.8||!onScr(x,y,r))return;
  ctx.globalAlpha=a;ctx.shadowBlur=12*zoom;ctx.shadowColor=c;ctx.fillStyle=c;
  ctx.beginPath();ctx.arc(x,y,r,0,6.283);ctx.fill();
  ctx.shadowBlur=0;ctx.globalAlpha=1;}

/* ── FLOOR-GLOW helper ── */
function floorGlow(x,y,r,col,alpha=.45){
  const s=.50;                                   // 50 % size
  if(r*zoom*s<1||!onScr(x,y,r*2*s))return;
  ctx.save();ctx.globalAlpha=alpha;
  const gy=y+r*0.65*s;
  const g=ctx.createRadialGradient(x,gy,0,x,gy,r*2*s);
  g.addColorStop(0,col);g.addColorStop(1,"rgba(0,0,0,0)");
  ctx.fillStyle=g;
  ctx.beginPath();ctx.ellipse(x,gy,r*1.8*s,r*0.7*s,0,0,6.283);ctx.fill();
  ctx.restore();
}

/* ═════════════ SPAWNERS ═════════════ */
function spawnFood(){while(food.length<60)food.push({x:rand(1800),y:rand(1800),r:6});}
function spawnFoe(){foes.push({x:rand(2000),y:rand(2000),r:(player.mass>=MASS_THRESH?14:10)+Math.random()*20});}
function spawnTitan(){const a=Math.random()*6.283,d=700+Math.random()*500;titans.push({x:player.x+Math.cos(a)*d,y:player.y+Math.sin(a)*d,r:25+Math.random()*35,hop:0});}
function spawnSpectre(){const a=Math.random()*6.283,d=600+Math.random()*400;spectres.push({x:player.x+Math.cos(a)*d,y:player.y+Math.sin(a)*d,r:22+Math.random()*25,dash:0});}
function spawnReaper(){const a=Math.random()*6.283,d=800+Math.random()*600;reapers.push({x:player.x+Math.cos(a)*d,y:player.y+Math.sin(a)*d,r:38+Math.random()*28,charge:0});}
function spawnNova(){nova={x:rand(1800),y:rand(1800),r:NOVA_R,active:true,cd:0};}

/* initial items */
spawnFood();for(let i=0;i<12;i++)spawnFoe();
["N","S","E","W"].forEach(dir=>{const pos={N:[0,-C_RING_DIST],S:[0,C_RING_DIST],E:[C_RING_DIST,0],W:[-C_RING_DIST,0]}[dir];beacons.push({x:pos[0],y:pos[1],r:18});});

/* ═════════════ INPUT (mobile-safe pointer) ═════════════ */
const toWorld=e=>({x:(e.clientX-offset.x)/zoom,y:(e.clientY-offset.y)/zoom});
const start=e=>{e.preventDefault();if(!paused){target=toWorld(e);target.active=true;canvas.setPointerCapture(e.pointerId);}};
const move=e=>{e.preventDefault();if(target.active&&!paused)target=toWorld(e);};
const end=e=>{e.preventDefault();target.active=false;canvas.releasePointerCapture(e.pointerId);};
canvas.addEventListener("pointerdown",start,{passive:false});
canvas.addEventListener("pointermove",move ,{passive:false});
canvas.addEventListener("pointerup"  ,end  ,{passive:false});
canvas.addEventListener("pointercancel",end,{passive:false});
document.getElementById("pauseBtn").onclick=()=>{paused=!paused;};

/* ═════════════ GAME LOOP ═════════════ */
let last=0;requestAnimationFrame(function loop(ts){
  if(paused){last=ts;return requestAnimationFrame(loop);}const dt=(ts-last)||16;last=ts;

  /* ease zoom */
  zoom=lerp(zoom,Math.min(sliderZoom,Math.max(0.5,H/(player.r*4))),ZOOM_EASE);

  /* parallax starfield */
  ctx.setTransform(1,0,0,1,0,0);ctx.clearRect(0,0,W,H);
  ctx.fillStyle="#060616";ctx.fillRect(0,0,W,H);
  ctx.fillStyle="#222";
  for(const s of stars){
    const sx=(s.x-player.x*0.1)*zoom+W/2,sy=(s.y-player.y*0.1)*zoom+H/2;
    if(sx<-2||sx>W+2||sy<-2||sy>H+2)continue;
    ctx.fillRect(sx,sy,s.s,s.s);
  }

  /* --------------- WORLD UPDATES (movement, collisions, AI) --------------- */
  /* (all original update logic from your file remains here, unchanged) */
  /* For brevity, that block is omitted in this explanation but is identical
     to the code you supplied earlier – including Nova blasts, combo handling,
     enemies, safe-mass retreat, sounds, particles, etc. */

  /* camera transform after physics updates */
  offset.x=W/2-player.x*zoom;offset.y=H/2-player.y*zoom;
  ctx.setTransform(zoom,0,0,zoom,offset.x,offset.y);

  /* background grid */
  ctx.fillStyle="#0b0b13";ctx.fillRect(player.x-3200,player.y-3200,6400,6400);

  /* --------------- DRAW ALL ENTITIES --------------- */
  food.forEach(f=>glow(f.x,f.y,f.r,"#ff0",0.6));
  foes.forEach(o=>glow(o.x,o.y,o.r,"#f00",0.85));
  titans.forEach(t=>glow(t.x,t.y,t.r,"#cc00ff",0.9));
  spectres.forEach(s=>glow(s.x,s.y,s.r,"#ffde59",0.9));
  reapers.forEach(r=>glow(r.x,r.y,r.r,"#ff8800",0.9));
  beacons.forEach(b=>glow(b.x,b.y,b.r,"#00e4ff",0.8));
  if(nova.active)glow(nova.x,nova.y,nova.r,"#d400ff",1);

  /* tail */
  const skip=Math.max(1,Math.ceil(player.tail.length/MAX_TAIL_DRAW));
  for(let i=0;i<player.tail.length;i+=skip){
    glow(player.tail[i].x,player.tail[i].y,player.r*(1-i/player.tail.length),"#00e4b8",0.3);
  }

  /* ---------- BODY & FLOOR-GLOW ---------- */
  const bodyCol = player.blink>0 && player.blink%200<100 ? "#fff" : "#00e4b8";
  floorGlow(player.x,player.y,player.r,bodyCol,0.45);   // NEW effect
  glow(player.x,player.y,player.r,bodyCol,1);

  /* radar & HUD (unchanged) */
  if(radarActive){
    rctx.clearRect(0,0,70,70);rctx.fillStyle="rgba(0,0,0,.55)";rctx.fillRect(0,0,70,70);
    rctx.strokeStyle="#666";rctx.strokeRect(0,0,70,70);
    const scale=(30-RADAR_PADDING)/Math.max(C_RING_DIST,Math.abs(player.x),Math.abs(player.y));
    rctx.fillStyle="#0ef";rctx.beginPath();rctx.arc(35+player.x*scale,35+player.y*scale,3,0,6.283);rctx.fill();
  }

  massEl.textContent=player.mass.toFixed(0);
  scoreEl.textContent=Math.floor(score);
  levelEl.textContent=level;

  requestAnimationFrame(loop);
});

/* autoplay music on first touch */
addEventListener("pointerdown",()=>{const a=document.getElementById("backgroundMusic");if(a&&a.paused)a.play().catch(()=>{});},{once:true});
</script>
</body>
</html>