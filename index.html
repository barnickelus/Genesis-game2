<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Genesis Evolution — Star-Frenzy Build</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<style>
 html,body{margin:0;height:100%;background:#060616;overflow:hidden;font-family:"Inter",Arial,sans-serif;}
 canvas{width:100%;height:100%;display:block;touch-action:none;background:#000;}
 #hud{position:fixed;top:14px;left:18px;color:#fff;font-size:15px;text-shadow:0 0 4px rgba(255,255,255,.3);z-index:2;}
 #compass{position:fixed;top:60px;left:18px;color:#aaa;font-size:12px;line-height:12px;letter-spacing:1px;text-shadow:0 0 2px #000;z-index:2;}
 #effBar{position:fixed;bottom:14px;left:18px;width:220px;height:18px;border-radius:9px;background:rgba(255,255,255,.12);z-index:2;}
 #effFill{width:100%;height:100%;border-radius:9px;background:#00e4b8;}
 #pauseBtn{position:fixed;top:14px;right:18px;font-size:22px;color:#fff;cursor:pointer;user-select:none;z-index:2;}
 #radarWrap{position:fixed;top:48px;right:18px;width:70px;height:70px;display:none;z-index:2;}
 #radar{width:70px;height:70px;border:1px solid #555;border-radius:4px;background:rgba(0,0,0,.4);}
 #zoomSlider{position:fixed;top:130px;right:18px;width:70px;transform:rotate(-90deg);z-index:2;}
</style>
</head>
<body>
<canvas id="game"></canvas>

<div id="hud">Mass: <span id="mass">10</span>&nbsp; Score: <span id="score">0</span>&nbsp; <span id="level">1</span></div>
<div id="compass">N<br>E&nbsp;&nbsp;W<br>&nbsp;S</div>
<div id="effBar"><div id="effFill"></div></div>
<div id="pauseBtn">⏸︎</div>
<div id="radarWrap"><canvas id="radar" width="70" height="70"></canvas></div>
<input id="zoomSlider" type="range" min="0.5" max="2" step="0.01" value="1">
<audio id="backgroundMusic" src="background-music.mp3" loop preload="auto"></audio>
<audio id="eatSnd" src="eat.mp3" preload="auto"></audio>
<audio id="hurtSnd" src="hurt.mp3" preload="auto"></audio>
<audio id="frenzySnd" src="frenzy.mp3" preload="auto"></audio>

<script>
/* === CONSTANTS & TUNABLES === */
const MASS_THRESH=600,TITAN_LEVEL=10,TITAN_MAX=6,TITAN_RESPAWN_MS=20000,
      SPECTRE_MAX=3,REAPER_MAX=3,C_RING_DIST=1600;
const SPECTRE_SPEED_MS=6000,SPECTRE_SPEED_MULT=1.25,
      RADAR_PADDING=4,ZOOM_EASE=0.25;
const MASS_SPEED_FACTOR=0.0012,EXTRA_TAIL_PCT=0.10,MAX_TAIL_DRAW=60,
      SAFE_PLAYER_MASS=70,BLINK_MS=300;

/* === CANVAS & ZOOM === */
const canvas=document.getElementById("game"),ctx=canvas.getContext("2d",{alpha:false});
ctx.imageSmoothingEnabled=false;
let W,H;function resize(){W=canvas.width=innerWidth;H=canvas.height=innerHeight;}resize();addEventListener("resize",resize);
let sliderZoom=1,zoom=1;document.getElementById("zoomSlider").addEventListener("input",e=>sliderZoom=parseFloat(e.target.value));

/* === HUD refs === */
const massEl=document.getElementById("mass"),scoreEl=document.getElementById("score"),levelEl=document.getElementById("level");
const pauseBtn=document.getElementById("pauseBtn"),radarWrap=document.getElementById("radarWrap"),
      rctx=document.getElementById("radar").getContext("2d");

/* === WORLD DATA === */
let player={x:0,y:0,r:15,mass:10,tail:[],baseSpeed:2.5,blink:0,speedBoost:0};
let target={x:0,y:0,active:false},offset={x:0,y:0};
/* … (UNCHANGED world-generation code – food, foes, titans, etc.) … */

/* === DRAW HELPERS === */
function glow(x,y,r,c,a){
  if(r*zoom<0.8||!onScreen(x,y,r))return;
  ctx.globalAlpha=a;
  ctx.shadowBlur=12*zoom;
  ctx.shadowColor=c;
  ctx.fillStyle=c;
  ctx.beginPath();
  ctx.arc(x,y,r,0,Math.PI*2);
  ctx.fill();
  ctx.shadowBlur=0;
  ctx.globalAlpha=1;
}

/* ★★★ NEW helper ★★★ */
function floorGlow(x,y,r){
  if(r*zoom<1||!onScreen(x,y,r*3))return;
  ctx.save();
  ctx.translate(x,y+r*0.15);          // a touch below the centre
  ctx.scale(2.4,0.55);               // stretch into a wide ellipse
  ctx.globalAlpha=0.28;              // mild transparency
  ctx.shadowBlur=60*zoom;            // soft edges
  ctx.shadowColor="#00e4b8";
  const grad=ctx.createRadialGradient(0,0,r*0.4,0,0,r*1.5);
  grad.addColorStop(0,"rgba(0,228,184,0.9)");
  grad.addColorStop(1,"rgba(0,228,184,0)");
  ctx.fillStyle=grad;
  ctx.beginPath();
  ctx.arc(0,0,r*1.5,0,Math.PI*2);
  ctx.fill();
  ctx.restore();
  ctx.globalAlpha=1;
}

/* === GAME LOOP === */
let last=0;
function loop(ts){
  if(paused){last=ts;return requestAnimationFrame(loop);}
  const dt=(ts-last)||16;last=ts;

  /* … (UNCHANGED movement, spawning, AI, etc.) … */

  /* === RENDER === */

  /* world-space set-up */
  ctx.setTransform(zoom,0,0,zoom,offset.x,offset.y);
  tesseract();          // background grid

  /* … (render food, foes, titans, particles, etc. exactly as before) … */

  /* player tail */
  const skip=Math.max(1,Math.ceil(player.tail.length/MAX_TAIL_DRAW));
  for(let i=0;i<player.tail.length;i+=skip){
    const p=player.tail[i];
    glow(p.x,p.y,
         player.r*(1-i/player.tail.length),
         mixHex("#00e4b8","#ff39ff",i/player.tail.length),
         0.3);
  }

  /* ★ render the floor glow first so the avatar sits on top ★ */
  floorGlow(player.x,player.y,player.r);

  /* avatar glow */
  glow(player.x,player.y,
       player.r,
       player.blink>0?(player.blink%200<100?"#fff":"#ff44ff"):"#00e4b8",
       1);

  /* … (rest of draw – aurora ring, radar, HUD) … */

  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

/* autoplay music once user interacts */
addEventListener("pointerdown",()=>{
  const a=document.getElementById("backgroundMusic");
  if(a&&a.paused)a.play().catch(()=>{});
},{once:true});

/* === EVERYTHING ELSE BELOW THIS LINE IS IDENTICAL === */
/*   (omitted for brevity; no logic changed)            */
</script>
</body>
</html>