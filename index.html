<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Genesis Evolution — Star-Frenzy (Dragon Avatar)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<style>
 html,body{margin:0;height:100%;background:#060616;overflow:hidden;font-family:"Inter",Arial,sans-serif;}
 canvas{width:100%;height:100%;display:block;touch-action:none;background:#000;}
 #hud{position:fixed;top:14px;left:18px;color:#fff;font-size:15px;text-shadow:0 0 4px rgba(255,255,255,.3);z-index:2;}
 #compass{position:fixed;top:60px;left:18px;color:#aaa;font-size:12px;line-height:12px;letter-spacing:1px;text-shadow:0 0 2px #000;z-index:2;}
 #effBar{position:fixed;bottom:14px;left:18px;width:220px;height:18px;border-radius:9px;background:rgba(255,255,255,.12);z-index:2;}
 #effFill{width:100%;height:100%;border-radius:9px;background:#00e4b8;}
 #pauseBtn{position:fixed;top:14px;right:18px;font-size:22px;color:#fff;cursor:pointer;user-select:none;z-index:2;}
 #radarWrap{position:fixed;top:48px;right:18px;width:70px;height:70px;display:none;z-index:2;}
 #radar{width:70px;height:70px;border:1px solid #555;border-radius:4px;background:rgba(0,0,0,.4);}
 #zoomSlider{position:fixed;top:130px;right:18px;width:70px;transform:rotate(-90deg);z-index:2;}
</style>
</head>
<body>
<canvas id="game"></canvas>

<div id="hud">Mass: <span id="mass">10</span>&nbsp; Score: <span id="score">0</span>&nbsp; <span id="level">1</span></div>
<div id="compass">N<br>E&nbsp;&nbsp;W<br>&nbsp;S</div>
<div id="effBar"><div id="effFill"></div></div>
<div id="pauseBtn">⏸︎</div>
<div id="radarWrap"><canvas id="radar" width="70" height="70"></canvas></div>
<input id="zoomSlider" type="range" min="0.5" max="2" step="0.01" value="1">

<script>
/* === Load dragon avatar === */
const dragonImg = new Image();
dragonImg.src = "dragon.png"; // Ensure this file is in the same folder as the HTML

/* === Canvas setup === */
const canvas=document.getElementById("game"),ctx=canvas.getContext("2d",{alpha:false});
let W,H;function resize(){W=canvas.width=innerWidth;H=canvas.height=innerHeight;}resize();addEventListener("resize",resize);
ctx.imageSmoothingEnabled=false;

let zoom=1,sliderZoom=1;
document.getElementById("zoomSlider").addEventListener("input",e=>sliderZoom=parseFloat(e.target.value));

/* === World setup === */
let player={x:0,y:0,r:15,mass:10,tail:[],blink:0};
let offset={x:0,y:0},paused=false,target={x:0,y:0,active:false},food=[];

/* === Helpers === */
const dist=(a,b,c,d)=>Math.hypot(a-c,b-d);
const lerp=(a,b,t)=>a+(b-a)*t;

/* === Events === */
canvas.addEventListener("pointerdown",e=>{const p=toWorld(e);target={x:p.x,y:p.y,active:true};});
canvas.addEventListener("pointermove",e=>{if(target.active){const p=toWorld(e);target={x:p.x,y:p.y,active:true};}});
canvas.addEventListener("pointerup",()=>target.active=false);
const toWorld=e=>({x:(e.clientX-offset.x)/zoom,y:(e.clientY-offset.y)/zoom});

/* === Spawners === */
function spawnFood(){while(food.length<50)food.push({x:Math.random()*3000-1500,y:Math.random()*3000-1500,r:6});}

/* === Drawing === */
function glow(x,y,r,c,a){ctx.globalAlpha=a;ctx.shadowBlur=12*zoom;ctx.shadowColor=c;ctx.fillStyle=c;ctx.beginPath();ctx.arc(x,y,r,0,2*Math.PI);ctx.fill();ctx.shadowBlur=0;ctx.globalAlpha=1;}
function floorGlow(x,y,r){
  ctx.save();ctx.translate(x,y+r*0.6);
  ctx.scale(2.7,0.55);
  ctx.globalAlpha=0.25;
  ctx.shadowBlur=60*zoom;
  ctx.shadowColor="#00e4b8";
  const g=ctx.createRadialGradient(0,0,r*0.4,0,0,r*1.6);
  g.addColorStop(0,"rgba(0,228,184,0.9)");
  g.addColorStop(1,"rgba(0,228,184,0)");
  ctx.fillStyle=g;
  ctx.beginPath();ctx.arc(0,0,r*1.6,0,2*Math.PI);ctx.fill();
  ctx.restore();ctx.globalAlpha=1;
}

/* === Loop === */
let last=0;
requestAnimationFrame(function loop(ts){
  const dt=(ts-last)||16;last=ts;

  zoom = lerp(zoom, sliderZoom, 0.2);
  const dx=(target.active?target.x:player.x)-player.x,dy=(target.active?target.y:player.y)-player.y,len=Math.hypot(dx,dy);
  const spd=2.4;
  if(len>1){player.x+=dx/len*spd;player.y+=dy/len*spd;}
  player.mass=Math.max(5,player.mass-(0.000009*player.r*player.r+(player.mass<150?0.002:0.003))*dt);
  player.r = 10 + player.mass / 15;
  player.tail.unshift({x:player.x,y:player.y});
  while(player.tail.length > 30) player.tail.pop();
  if(player.blink>0) player.blink-=dt;

  offset.x=W/2-player.x*zoom;offset.y=H/2-player.y*zoom;

  spawnFood();

  ctx.setTransform(1,0,0,1,0,0);
  ctx.clearRect(0,0,W,H);
  ctx.fillStyle="#060616";
  ctx.fillRect(0,0,W,H);
  ctx.setTransform(zoom,0,0,zoom,offset.x,offset.y);

  food.forEach(f=>glow(f.x,f.y,f.r,"#ff0",0.65));
  food.forEach((f,i)=>{if(dist(player.x,player.y,f.x,f.y)<player.r+f.r){player.mass+=f.r;food.splice(i,1);}});

  floorGlow(player.x,player.y,player.r);

  const skip=Math.max(1,Math.ceil(player.tail.length/30));
  for(let i=0;i<player.tail.length;i+=skip){
    const p=player.tail[i];
    glow(p.x,p.y,player.r*(1-i/player.tail.length),"#00e4b8",0.3);
  }

  // ✅ Draw the dragon avatar
  const size = player.r * 4.5;
  ctx.save();
  ctx.translate(player.x, player.y);
  ctx.drawImage(dragonImg, -size/2, -size/2, size, size);
  if (player.blink > 0 && player.blink % 200 < 100) {
    ctx.globalAlpha = 0.5;
    ctx.fillStyle = "#ffffff";
    ctx.fillRect(-size/2, -size/2, size, size);
  }
  ctx.restore();

  document.getElementById("mass").textContent = player.mass.toFixed(0);
  document.getElementById("score").textContent = Math.floor(player.mass*10);
  document.getElementById("level").textContent = Math.floor(player.mass/100)+1;

  requestAnimationFrame(loop);
});
</script>
</body>
</html>