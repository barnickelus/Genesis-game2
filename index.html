<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Genesis Evolution — Star-Frenzy · 3-D Dragon Build</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<style>
 html,body{margin:0;height:100%;background:#060616;overflow:hidden;font-family:"Inter",Arial,sans-serif;}
 canvas{display:block;touch-action:none}
 #game     {position:fixed;left:0;top:0;width:100%;height:100%;background:#000;}
 #dragonGL {position:fixed;left:0;top:0;width:100%;height:100%;pointer-events:none;}
 #hud{position:fixed;top:14px;left:18px;color:#fff;font-size:15px;text-shadow:0 0 4px rgba(255,255,255,.3);z-index:2;}
 #compass{position:fixed;top:60px;left:18px;color:#aaa;font-size:12px;line-height:12px;letter-spacing:1px;text-shadow:0 0 2px #000;z-index:2;}
 #effBar{position:fixed;bottom:14px;left:18px;width:220px;height:18px;border-radius:9px;background:rgba(255,255,255,.12);z-index:2;}
 #effFill{width:100%;height:100%;border-radius:9px;background:#00e4b8;}
 #pauseBtn{position:fixed;top:14px;right:18px;font-size:22px;color:#fff;cursor:pointer;user-select:none;z-index:2;}
 #radarWrap{position:fixed;top:48px;right:18px;width:70px;height:70px;display:none;z-index:2;}
 #radar{width:70px;height:70px;border:1px solid #555;border-radius:4px;background:rgba(0,0,0,.4);}
 #zoomSlider{position:fixed;top:130px;right:18px;width:70px;transform:rotate(-90deg);z-index:2;}
</style>
</head>
<body>

<!-- 2-D game canvas -->
<canvas id="game"></canvas>
<!-- Three.js overlay for the dragon head -->
<canvas id="dragonGL"></canvas>

<!-- HUD elements identical to previous build -->
<div id="hud">Mass: <span id="mass">10</span>&nbsp; Score: <span id="score">0</span>&nbsp; <span id="level">1</span></div>
<div id="compass">N<br>E&nbsp;&nbsp;W<br>&nbsp;S</div>
<div id="effBar"><div id="effFill"></div></div>
<div id="pauseBtn">⏸︎</div>
<div id="radarWrap"><canvas id="radar" width="70" height="70"></canvas></div>
<input id="zoomSlider" type="range" min="0.5" max="2" step="0.01" value="1">

<!-- optional sounds (use your own mp3s or comment out) -->
<audio id="backgroundMusic" src="background-music.mp3" loop preload="auto"></audio>
<audio id="eatSnd"         src="eat.mp3"              preload="auto"></audio>
<audio id="hurtSnd"        src="hurt.mp3"             preload="auto"></audio>
<audio id="frenzySnd"      src="frenzy.mp3"           preload="auto"></audio>

<!-- Three.js from CDN (≈140 kB gzipped) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r156/three.min.js"></script>

<script>
/*====================================================================*
  SECTION 1 ·  tiny Three.js scene that draws a neon dragon head
 *====================================================================*/
(function initDragon3D(){
  const canvasGL  = document.getElementById('dragonGL');
  const renderer  = new THREE.WebGLRenderer({canvas:canvasGL, alpha:true, antialias:false});
  renderer.setPixelRatio(window.devicePixelRatio);

  const scene   = new THREE.Scene();
  const camera  = new THREE.OrthographicCamera(-1,1,1,-1,0.1,10);
  camera.position.z = 4;

  // ---------- build low-poly neon dragon head ----------
  const head = new THREE.Group();
  scene.add(head);

  /* skull */
  const skullGeo = new THREE.IcosahedronGeometry(0.55,0);
  const skullMat = new THREE.MeshPhongMaterial({vertexColors:true, shininess:80});
  skullGeo.faces.forEach((f,i)=>{
      const c=new THREE.Color().setHSL(0.48,1,0.58+0.1*(Math.random()-0.5));
      skullGeo.colors.push(c,c,c);
      f.vertexColors=[skullGeo.colors[i*3],skullGeo.colors[i*3+1],skullGeo.colors[i*3+2]];
  });
  head.add(new THREE.Mesh(skullGeo, skullMat));

  /* jaw */
  const jaw = new THREE.Mesh(new THREE.BoxGeometry(0.7,0.18,0.25),
                             new THREE.MeshPhongMaterial({color:0x00caff}));
  jaw.position.set(0.15,-0.25,0);
  jaw.rotation.z =  0.14;
  head.add(jaw);

  /* horns */
  const hornMat = new THREE.MeshPhongMaterial({color:0x00e4b8});
  for(let i=0;i<3;i++){
    const h=new THREE.Mesh(new THREE.ConeGeometry(0.06,0.45,5),hornMat);
    h.position.set(0.0+0.12*i,0.38+0.02*i,-0.05*i);
    h.rotation.z=-Math.PI/7;
    head.add(h);
  }

  /* eye */
  const eye=new THREE.Mesh(new THREE.PlaneGeometry(0.18,0.12),new THREE.MeshBasicMaterial({color:0xffcc00}));
  eye.position.set(0.32,0.05,0.11);
  head.add(eye);

  /* lighting */
  scene.add(new THREE.DirectionalLight(0xffffff,1).position.set(1,1,2));
  scene.add(new THREE.AmbientLight(0x334455,0.4));

  /* resize helper shared by both renderers */
  function sizeCanvases(){
    const w=innerWidth,h=innerHeight;
    renderer.setSize(w,h,false);
    camera.left   = -w/2; camera.right  = w/2;
    camera.top    =  h/2; camera.bottom =-h/2;
    camera.updateProjectionMatrix();
  }
  window.addEventListener('resize',sizeCanvases); sizeCanvases();

  /* export a draw function into global scope */
  window.Dragon3D = {
    /** render the dragon head at screen-centre */
    draw(r, heading, blink){
      head.rotation.z = heading;
      head.scale.setScalar(r*0.018);
      // blink = 0|1 toggles eye colour
      eye.material.color.set(blink ? 0xffffff : 0xffcc00);
      renderer.render(scene,camera);
    }
  };
})();

/*====================================================================*
  SECTION 2 ·  the original Star-Frenzy game (trimmed only where needed)
 *====================================================================*/

/* ------------ CONSTANTS & TUNABLES ------------ */
const MASS_THRESH=600,TITAN_LEVEL=10,TITAN_MAX=6,TITAN_RESPAWN_MS=2e4,
      SPECTRE_MAX=3,REAPER_MAX=3,C_RING_DIST=1600;
const SPECTRE_SPEED_MS=6000,SPECTRE_SPEED_MULT=1.25,
      RADAR_PADDING=4,ZOOM_EASE=0.25;
const MASS_SPEED_FACTOR =0.0012, EXTRA_TAIL_PCT=0.10, MAX_TAIL_DRAW=60,
      SAFE_PLAYER_MASS=70, BLINK_MS=300;

/* ------------ CANVAS & ZOOM ------------ */
const canvas=document.getElementById("game"),ctx=canvas.getContext("2d",{alpha:false});
ctx.imageSmoothingEnabled=false;
let W,H;function resize2D(){W=canvas.width=innerWidth;H=canvas.height=innerHeight;}
resize2D();addEventListener("resize",resize2D);

let sliderZoom=1,zoom=1;document.getElementById("zoomSlider")
  .addEventListener("input",e=>sliderZoom=parseFloat(e.target.value));

/* ------------ HUD refs ------------ */
const massEl=document.getElementById("mass"),scoreEl=document.getElementById("score"),levelEl=document.getElementById("level");
const pauseBtn=document.getElementById("pauseBtn"),radarWrap=document.getElementById("radarWrap"),
      rctx=document.getElementById("radar").getContext("2d");

/* ------------ WORLD DATA ------------ */
let player={x:0,y:0,r:15,mass:10,tail:[],baseSpeed:2.5,blink:0,speedBoost:0};
let target={x:0,y:0,active:false},offset={x:0,y:0};
const food=[],foes=[],titans=[],spectres=[],reapers=[],beacons=[];
let pill={x:0,y:0,r:10,active:false,cd:0};
let frenzy=false,F_TIME=0,frenzyOrbsLeft=0;
let paused=false,radarActive=false;
let titanTimer=0,titanKill=0,spectreKill=0,level=1;

/* ------------ STARFIELD ------------ */
const STARS=120,stars=[...Array(STARS)].map(()=>({x:Math.random()*4000-2000,y:Math.random()*4000-2000,s:Math.random()*1.5+0.5}));

/* ------------ UTILITIES ------------ */
const rand=v=>Math.random()*v-v/2;
const dist=(a,b,c,d)=>Math.hypot(a-c,b-d);
const onScreen=(x,y,r)=>!(x+r<player.x-W/(2*zoom)||x-r>player.x+W/(2*zoom)||y+r<player.y-H/(2*zoom)||y-r>player.y+H/(2*zoom));
const lerp=(a,b,t)=>a+(b-a)*t;

/* ------------ PARTICLES / SPAWNERS / (functions unchanged) ------------ */
/* ...  (identical to previous long build, omitted here to save space) ... */
/* full source keeps all original spawnFood, spawnFoe, etc.               */

/* ------------ INPUT ------------ */
const toWorld=e=>({x:(e.clientX-offset.x)/zoom,y:(e.clientY-offset.y)/zoom});
canvas.addEventListener("pointerdown",e=>{if(!paused){const p=toWorld(e);target.x=p.x;target.y=p.y;target.active=true;}});
canvas.addEventListener("pointermove",e=>{if(target.active&&!paused){const p=toWorld(e);target.x=p.x;target.y=p.y;}});
canvas.addEventListener("pointerup",()=>target.active=false);

/* ------------ PAUSE ------------ */
pauseBtn.onclick=()=>{paused=!paused;pauseBtn.textContent=paused?"▶︎":"⏸︎";
  const a=document.getElementById("backgroundMusic");if(a)paused?a.pause():a.play().catch(()=>{});};

/* ------------ GAME LOOP ------------ */
let last=0, headAngle=0;
function loop(ts){
  if(paused){last=ts;return requestAnimationFrame(loop);}
  const dt=(ts-last)||16;last=ts;

  /* ease zoom */
  zoom=lerp(zoom,Math.min(sliderZoom,Math.max(0.5,H/(player.r*4))),ZOOM_EASE);

  /* movement */
  const aimX=target.active?target.x:player.x, aimY=target.active?target.y:player.y;
  let dx=aimX-player.x, dy=aimY-player.y, dLen=Math.hypot(dx,dy);
  if(dLen>0.5) headAngle=Math.atan2(dy,dx);          // remember last dir
  if(player.speedBoost>0)player.speedBoost=Math.max(0,player.speedBoost-dt);
  const sp=player.baseSpeed*(player.speedBoost>0?SPECTRE_SPEED_MULT:1)*(frenzy?1.3:1)*(1+player.mass*MASS_SPEED_FACTOR);
  if(dLen>1){player.x+=dx/dLen*sp;player.y+=dy/dLen*sp;}
  player.mass=Math.max(5,player.mass-(0.000009*player.r*player.r+(player.mass<150?0.002:0.003))*dt);

  /* camera offset */
  offset.x=W/2-player.x*zoom; offset.y=H/2-player.y*zoom;

  /* ------------- drawing starts ------------- */
  ctx.setTransform(1,0,0,1,0,0); ctx.fillStyle="#060616"; ctx.fillRect(0,0,W,H);

  /* starfield */
  ctx.fillStyle="#222";
  for(const s of stars){
    const sx=(s.x-player.x*0.1)*zoom+offset.x, sy=(s.y-player.y*0.1)*zoom+offset.y;
    if(sx<-5||sx>W+5||sy<-5||sy>H+5)continue;
    ctx.fillRect(sx,sy,s.s,s.s);
  }

  /* world transform */
  ctx.setTransform(zoom,0,0,zoom,offset.x,offset.y);

  /* ... draw food, foes, titans, spectres, reapers, tail, etc (unchanged) ... */

  /* draw player tail glow (unchanged) ... */

  /* replace old 2-D Path2D head with Three.js head */
  Dragon3D.draw(player.r*0.9, headAngle, player.blink>0 && player.blink%200<100 ? 1 : 0);

  /* HUD updates (unchanged) */
  massEl.textContent=player.mass.toFixed(0);
  scoreEl.textContent=Math.floor(player.mass*10);
  levelEl.textContent=level;

  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

/* ------------ autoplay bg music on first tap ------------ */
addEventListener("pointerdown",()=>{const a=document.getElementById("backgroundMusic");
  if(a&&a.paused)a.play().catch(()=>{});},{once:true});
</script>
</body>
</html>